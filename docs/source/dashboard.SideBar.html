<!doctype html><html>  <head>    <meta charset="utf-8">    <base href="../">    <title>JSDoc: source : dashboard.js</title>    <link href="css/prettify-tomorrow.css" type="text/css" rel="stylesheet">    <link href="css/site.css" type="text/css" rel="stylesheet">  </head>  <body ng-app="">    <nav id="toc">      <input placeholder="Filter" id="filter-input" class="col12 block field" type="text">      <div class="nav-wrapper">      <h2><a href="index.html">Index</a></h2>      <ul class="module">        <!-- dashboard -->        <h2 class="module">          <a chref="" ng-click="moduledashboard = !moduledashboard">            module: dashboard          </a>          <i ng-cloak="" ng-show="moduledashboard">+</i>        </h2>        <li id="dashboard" ng-hide="moduledashboard">          <ul class="group">            <h2>              <a href="" ng-click="dashboardfilter = !dashboardfilter">                filter              </a>              <i ng-cloak="" ng-show="dashboardfilter">+</i>            </h2>            <ul ng-hide="dashboardfilter">              <li>                <a href="dashboard.Alinhamento.html">Alinhamento</a>              </li><li>                <a href="dashboard.NoSpace.html">NoSpace</a>              </li><li>                <a href="dashboard.RaplaceHash.html">RaplaceHash</a>              </li><li>                <a href="dashboard.RemovePx.html">RemovePx</a>              </li><li>                <a href="dashboard.SufixPx.html">SufixPx</a>              </li><li>                <a href="dashboard.twoDigits.html">twoDigits</a>              </li><li>                <a href="dashboard.YesNo.html">YesNo</a>              </li>            </ul>          </ul><ul class="group">            <h2>              <a href="" ng-click="dashboardcontroller = !dashboardcontroller">                controller              </a>              <i ng-cloak="" ng-show="dashboardcontroller">+</i>            </h2>            <ul ng-hide="dashboardcontroller">              <li>                <a href="dashboard.AplicativoController.html">AplicativoController</a>              </li><li>                <a href="dashboard.CadastrarConvidadoController.html">CadastrarConvidadoController</a>              </li><li>                <a href="dashboard.CardapioController.html">CardapioController</a>              </li><li>                <a href="dashboard.CasalController.html">CasalController</a>              </li><li>                <a href="dashboard.CerimoniaController.html">CerimoniaController</a>              </li><li>                <a href="dashboard.ConvidadosConfirmadosController.html">ConvidadosConfirmadosController</a>              </li><li>                <a href="dashboard.ConviteController.html">ConviteController</a>              </li><li>                <a href="dashboard.CotasController.html">CotasController</a>              </li><li>                <a href="dashboard.EnviarConviteController.html">EnviarConviteController</a>              </li><li>                <a href="dashboard.EstatisticaController.html">EstatisticaController</a>              </li><li>                <a href="dashboard.HotelController.html">HotelController</a>              </li><li>                <a href="dashboard.LoginController.html">LoginController</a>              </li><li>                <a href="dashboard.MainController.html">MainController</a>              </li><li>                <a href="dashboard.PagamentoController.html">PagamentoController</a>              </li><li>                <a href="dashboard.PersonalizarController.html">PersonalizarController</a>              </li><li>                <a href="dashboard.PresentesController.html">PresentesController</a>              </li><li>                <a href="dashboard.RecepcaoController.html">RecepcaoController</a>              </li><li>                <a href="dashboard.SalaoController.html">SalaoController</a>              </li><li>                <a href="dashboard.SaveDateController.html">SaveDateController</a>              </li><li>                <a href="dashboard.SidebarController.html">SidebarController</a>              </li><li>                <a href="dashboard.SideConviteController.html">SideConviteController</a>              </li>            </ul>          </ul><ul class="group">            <h2>              <a href="" ng-click="dashboardservice = !dashboardservice">                service              </a>              <i ng-cloak="" ng-show="dashboardservice">+</i>            </h2>            <ul ng-hide="dashboardservice">              <li>                <a href="dashboard.Cielo.html">Cielo</a>              </li><li>                <a href="dashboard.Controlador.html">Controlador</a>              </li><li>                <a href="dashboard.conversorService.html">conversorService</a>              </li><li>                <a href="dashboard.EnviarEmail.html">EnviarEmail</a>              </li><li>                <a href="dashboard.EnviarFoto.html">EnviarFoto</a>              </li><li>                <a href="dashboard.ListManagerService.html">ListManagerService</a>              </li><li>                <a href="dashboard.serverService.html">serverService</a>              </li>            </ul>          </ul><ul class="group">            <h2>              <a href="" ng-click="dashboardconfig = !dashboardconfig">                config              </a>              <i ng-cloak="" ng-show="dashboardconfig">+</i>            </h2>            <ul ng-hide="dashboardconfig">              <li>                <a href="dashboard.Config.html">Config</a>              </li><li>                <a href="dashboard.RouteConfig.html">RouteConfig</a>              </li><li>                <a href="dashboard.Run.html">Run</a>              </li><li>                <a href="dashboard.startup.html">startup</a>              </li>            </ul>          </ul><ul class="group">            <h2>              <a href="" ng-click="dashboardfactory = !dashboardfactory">                factory              </a>              <i ng-cloak="" ng-show="dashboardfactory">+</i>            </h2>            <ul ng-hide="dashboardfactory">              <li>                <a href="dashboard.consultCEP.html">consultCEP</a>              </li><li>                <a href="dashboard.RequestAsFormPost.html">RequestAsFormPost</a>              </li><li>                <a href="dashboard.session.html">session</a>              </li>            </ul>          </ul><ul class="group">            <h2>              <a href="" ng-click="dashboarddirective = !dashboarddirective">                directive              </a>              <i ng-cloak="" ng-show="dashboarddirective">+</i>            </h2>            <ul ng-hide="dashboarddirective">              <li>                <a href="dashboard.httpPrefix.html">httpPrefix</a>              </li><li>                <a href="dashboard.SideBar.html">SideBar</a>              </li>            </ul>          </ul>        </li>      </ul>      </div>    </nav>    <div id="content" class="page-wrap">      <h1 class="title">        source : dashboard.js      </h1>      <div id="main" class="big-container">        <!-- source code html -->        <article>          <pre class="prettyprint source linenums"><code>(function () {  'use strict';  /**   * @ngdoc config   * @scope {}   * @name startup   * @memberof dashboard   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Modulo principal do dshboard.&lt;br>   * @param {module} ngMaterial    - Material Design para Angular {@link https://material.angularjs.org/latest/}   * @param {module} ngAria        - Necessario para o ngMaterial {@link https://docs.angularjs.org/api/ngAria}   * @param {module} ngMessages    - Necessario para o ngMaterial {@link https://docs.angularjs.org/api/ngMessages/directive/ngMessages}   * @param {module} ui.router     - Rotas do Angular(troca de view) {@link https://github.com/angular-ui/ui-router}   * @param {module} toastr        - Notificações {@link https://github.com/CodeSeven/toastr}   * @param {module} ngMask        - Mascara para os inputs {@link https://github.com/candreoliveira/ngMask}   * @param {module} ngImageEditor - Usado para recortar a foto do casal {@link https://github.com/SparrowJang/ngImageEditor}   * @param {module} ngMdIcons     - Icones para o ngMaterial {@link https://klarsys.github.io/angular-material-icons/}   * @param {module} chart.js      - Cria graficos {@link http://jtblin.github.io/angular-chart.js/}   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/module} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#startup-logic} Para melhores praticas   */  angular.module('dashboard', [    'ngMaterial',    'ngAria',    'ngMessages',    'ui.router',    'toastr',    'ngMask',    'ngImageEditor',    'ngMdIcons',    'ngSanitize',    'chart.js'  ]);})();
(function () {  'use strict';  angular    .module('dashboard')    .config(RouteConfig);  RouteConfig.$inject = ['$stateProvider', '$locationProvider', '$urlRouterProvider'];  /**   * @memberof dashboard   * @ngdoc config   * @scope {}   * @name RouteConfig   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Controla as rotas do dashboard.&lt;br>   * Pasta de origem : app/ &lt;br>   * @param {service} $stateProvider   * @param {service} $locationProvider   * @param {service} $urlRouterProvider   * @see Veja [Angular DOC]    {@link https://ui-router.github.io/ng1/} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#routing} Para melhores praticas   */  function RouteConfig($stateProvider, $locationProvider, $urlRouterProvider) {    $urlRouterProvider.otherwise('/login');    $locationProvider.html5Mode(true);    $stateProvider      .state('login', {        url: '/login',        cache: true,        templateUrl: 'app/login/login.html',        controller: 'LoginController',        controllerAs: 'login',        title: '- Acessar o Dashboard',        isLogin: true      })      .state('pagamento', {        url: '/pagamento',        cache: false,        templateUrl: 'app/pagamento/pagamento.html',        controller: 'PagamentoController',        controllerAs: 'pgto',        title: '- Pagamento'      })      .state('casal', {        url: '/casal',        cache: false,        templateUrl: 'app/casal/casal.html',        controller: 'CasalController',        controllerAs: 'casal',        title: '- Dados do Casal'      })      .state('cerimonia', {        url: '/convite/cerimonia',        cache: false,        templateUrl: 'app/convite/cerimonia/cerimonia.html',        controller: 'CerimoniaController',        controllerAs: 'cerimonia',        title: '- Cerimônia'      })      .state('convite', {        url: '/convite/escolher-convite',        cache: false,        templateUrl: 'app/convite/selecao/convite.html',        controller: 'ConviteController',        controllerAs: 'convite',        title: '- Escolha de Convite'      })      .state('personalizar', {        url: '/convite/personalizar-convite',        cache: false,        params: {          idModelo: null        },        templateUrl: 'app/convite/personalizar/personalizar.html',        controller: 'PersonalizarController',        controllerAs: 'convite',        title: '- Personalizar de Convite'      })      .state('savethedate', {        url: '/save-the-date',        cache: false,        templateUrl: 'app/convite/date/save-date.html',        controller: 'SaveDateController',        controllerAs: 'save',        title: '- Save the Date'      })      .state('aplicativo', {        url: '/convite/aplicativo',        cache: false,        templateUrl: 'app/convite/aplicativo/aplicativo.html',        controller: 'AplicativoController',        controllerAs: 'app',        title: '- Aplicativo'      })      .state('enviarConvite', {        url: '/convite/enviar',        cache: false,        templateUrl: 'app/convite/enviar.html',        controller: 'EnviarConviteController',        controllerAs: 'enviar',        title: '- Enviar Convite'      })      .state('recepcao', {        url: '/evento/recepcao',        cache: false,        templateUrl: 'app/evento/recepcao/recepcao.html',        controller: 'RecepcaoController',        controllerAs: 'recepcao',        title: '- Recepção'      })      .state('hotel', {        url: '/evento/dicas-de-hotel',        cache: false,        templateUrl: 'app/evento/hotel/hotel.html',        controller: 'HotelController',        controllerAs: 'hotel',        title: '- Dicas de Hotel'      })      .state('salao', {        url: '/evento/dicas-de-salao-de-beleza',        cache: false,        templateUrl: 'app/evento/salao/salao.html',        controller: 'SalaoController',        controllerAs: 'salao',        title: '- Dicas de Salão de Beleza'      })      .state('presentes', {        url: '/evento/lista-de-presentes',        cache: false,        templateUrl: 'app/evento/presentes/presentes.html',        controller: 'PresentesController',        controllerAs: 'presentes',        title: '- Lista de Presentes'      })      .state('cardapio', {        url: '/evento/cardapio',        cache: false,        templateUrl: 'app/evento/cardapio/cardapio.html',        controller: 'CardapioController',        controllerAs: 'cardapio',        title: '- Cardápio'      })      .state('cotas', {        url: '/evento/cotas-de-lua-de-mel',        cache: false,        templateUrl: 'app/evento/cotas/cotas.html',        controller: 'CotasController',        controllerAs: 'cotas',        title: '- Cotas de Lua de Mel'      })      .state('cadastrarConvidados', {        url: '/convidado/cadastrar',        cache: false,        templateUrl: 'app/convidado/cadastrar.html',        controller: 'CadastrarConvidadoController',        controllerAs: 'convidados',        title: '- Cadastrar Convidados'      })      .state('convidadosConfirmados', {        url: '/convidado/confirmados',        cache: false,        templateUrl: 'app/convidado/confirmados.html',        controller: 'ConvidadosConfirmadosController',        controllerAs: 'convidados',        title: '- Convidados Confirmados'      })      .state('estatisticas', {        url: '/estatisticas',        cache: false,        templateUrl: 'app/estatisticas/estatisticas.html',        controller: 'EstatisticaController',        controllerAs: 'ctrl',        title: '- Estatísticas'      });  }})();
(function () {  'use strict';  angular    .module('dashboard')    .controller('CasalController', CasalController);  /** @desc injetor dos serviços */  CasalController.$inject = ['serverService', 'conversorService', 'session', '$filter', 'toastr', 'EnviarFoto', '$scope', '$rootScope'];  /**   * @memberof dashboard   * @ngdoc controller   * @scope {}   * @name CasalController   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Receber e enviar dados do casal ( nome do casal, data de casamento e foto ).&lt;br>   * Pasta de origem : app/casal &lt;br>   * State : casal &lt;br>   * Controller As : casal&lt;br>   * Template Url : app/casal/casal.html &lt;br>&lt;br>   * Usa o serviço(s) do(s) servidor:   *  - AtualizarDadosCadastroNoivos {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/AtualizarDadosCadastroNoivos}   *   * @param {service} serverService    - usado para comunicar com o servidor {@link dashboard.serverService}   * @param {service} conversorService - usado para converter xml &lt;-> json {@link dashboard.conversorService}   * @param {service} session          - usado para armazenar e buscar dados no session {@link dashboard.session}   * @param {service} $filter          - usado para formatar a data de casamento   * @param {service} toastr           - usado para mostrar mensagens ao usuario   * @param {service} EnviarFoto       - envia a foto do casal para o servidor {@link dashboard.EnviarFoto}   * @param {service} $scope           - usado para colocar um listen no input[file] que vai receber a foto do casal   * @param {service} $rootScope       - scope geral   *   * @property {int} ID                 - id do usuario logado.Usado para fazer requisições `const`   * @property {object} vm              - A named variable for the `this` keyword representing the ViewModel   * @property {boolean} vm.carregando  - Controla o loading   * @property {json} vm.dados          - Formatação dos dados a serem enviados ao servidor. Veja o serviço AtualizarDadosCadastroNoivos   *   * @property {int} vm.dados.Casal.Id_casal            - id do casal   * @property {boolean} vm.dados.Casal.AtualizarSenha  - indentifica se a senha esta sendo trocada. &lt;strong> Não Alterar &lt;/strong>   * @property {string} vm.dados.Casal.DataCasamento    - data do casamento   * @property {string} vm.dados.Casal.NomeNoiva        - nome da noiva   * @property {string} vm.dados.Casal.NomeNoivo        - nome do noivo   * @property {string} vm.dados.Casal.Senha            - senha do casal. So deve preencher se estiver alterando. &lt;strong> Não Alterar &lt;/strong>   *   * @property {date} vm.dateMin         - Data minima para mostrar no datepicker   * @property {boolean} vm.erro         - Mostra msg de erro quando nao conecta com o servidor   * @property {boolean} vm.fotoEditor   - Controla o display do popup para recortar a foto   * @property {json} vm.genero          - Controla o genero de algumas palavras, baseado no genero dos noivos   * @property {string} vm.imageEditor   - Armazena a imagem do casal   * @property {json} vm.selected        - Configuração do editor de imagem   * @property {int} vm.selected.width  - Largura inicial da area de corte   * @property {int} vm.selected.height - Altura inicial da area de corte   * @property {int} vm.selected.top    - Posição inicial vertical em relação ao topo da area de corte   * @property {int} vm.selected.left   - Posição inicial horizontal em relação ao topo da area de corte   *   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/controller} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#controllers} Para melhores praticas   * @see Veja [Servidor Help]  {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help} Para saber sobre os serviços do servidor   */  function CasalController(serverService, conversorService, session, $filter, toastr, EnviarFoto, $scope, $rootScope) {    const ID = session.user.id;    var vm = this;    vm.carregando = false;    vm.dados = {      'Casal': {        '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',        'Id_casal': 2147483647,        'AtualizarSenha': false,        'DataCasamento': '',        'NomeNoiva': session.user.casal.nomeNoiva,        'NomeNoivo': session.user.casal.nomeNoivo,        'Senha': ''      }    };    vm.dateMin = new Date();    vm.erro = false;    vm.fotoEditor = false;    vm.genero = {      'noiva': session.user.casal.generoNoiva,      'noivo': session.user.casal.generoNoivo    };    vm.imageEditor = '';    vm.selected = {      width: 50,      height: 50,      top: 0,      left: 0    };    /**     * Atribuição das funçoes as variaveis do escopo     */    vm.Cancelar = ResetDados;    vm.Salvar = Salvar;    vm.UploadFoto = UploadFoto;    $scope.OpenFile = OpenFile;    Activate();    ////////////////    /**     * @function Activate     * @desc Setup docontrolador. Exetuca assim que o controlador inicia     * @memberof CasalController     */    function Activate() {      ResetDados();    }    /**     * @function OpenFile     * @desc Executa quando uma nova foto eh selecionada. Ativa o recorte para o usuario recortar     * @memberof CasalController     */    function OpenFile(elem) {      vm.carregando = true;      var reader = new FileReader();      reader.onload = function () {        var dataURL = reader.result;        vm.fotoEditor = dataURL;        vm.carregando = false;        vm.editar = true;        // Configura os valores para a area de corte inicial        vm.selected.width = 200;        vm.selected.height = 200;        vm.selected.left = 0;        vm.selected.top = 0;      };      reader.readAsDataURL(elem.files[0]);    }    /**     * @function ResetDados     * @desc Desfaz as modificações, não salvas, do usuario     * @memberof CasalController     */    function ResetDados() {      var casamento = session.user.casal.dataCasamento.split('/');      var data = new Date(casamento[2], casamento[1] - 1, casamento[0]);      vm.dados.Casal.DataCasamento = data;      vm.dados.Casal.NomeNoiva = session.user.casal.nomeNoiva;      vm.dados.Casal.NomeNoivo = session.user.casal.nomeNoivo;    }    /**     * @function  Salvar     * @desc Envia o nome do casal e a data do casamento para o servidor e armazena no session     * @memberof CasalController     */    function Salvar() {      vm.carregando = true;      var dados = conversorService.Json2Xml(vm.dados, '');      //Salva os nomes no session para serem usados em outras views      session.user.casal.nomeNoiva = vm.dados.Casal.NomeNoiva;      session.user.casal.nomeNoivo = vm.dados.Casal.NomeNoivo;      // Formata a data      session.user.casal.dataCasamento = $filter('date')(vm.dados.Casal.DataCasamento, 'dd/MM/yyyy');      session.SaveState();      serverService.Request('AtualizarDadosCadastroNoivos', dados).then(function (resp) {        vm.carregando = false;        toastr.success('Alterações Salvas!');      }).catch(function (error) {        /**         * Esse bloco eh executado caso haja algum erro no envio de dados para o servidor         */        console.error('AtualizarDadosCadastroNoivos -> ', error);        vm.carregando = false;        vm.erro = true;        toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');      });    }    /**     * @function UploadFoto     * @desc Enviar a foto recortada para o servidor e armazena a nova url da foto     * @memberof CasalController     */    function UploadFoto() {      vm.carregando = true; //Esconde foto atual e mostra gif de loding      /**       * Pega a foto recordada       * Transforma em jpg       * Passa para a base64       */      var imagemCortada = vm.imageEditor.toDataURL({        useOriginalImg: true,        imageType: 'image/jpg'      });      EnviarFoto.Request(ID, imagemCortada).then(function (resp) {        var novaImg = '';        var time = new Date(); //Pega a data e hora atual        /**         * O nome da imagem nunca muda,portanto         * ela fica no cache. Para evitar o cache         * eh preciso colocar ?+a hora atual         */        try {          novaImg = $rootScope.foto.split('?'); //Retira a hora antiga          novaImg = novaImg[0] + '?' + $filter('date')(time, 'H:mm', '-0300');        } catch (error) {          novaImg = imagemCortada;        }        /**         * Armazena o nome da imagem com a hora atual         * O filtro [$filter('date')] mostra so a hora         */        $rootScope.foto = novaImg; //Salva a foto no scopo global e na pagina atual        session.user.casal.urlFoto = novaImg; //Salva a foto local        session.SaveState();        vm.carregando = false; //seconde o gif de loding e mostra a nova imagem      }).catch(function (error) {        /**         * Esse bloco eh executado caso haja algum erro no envio de dados para o servidor         */        console.error('UploadFoto -> ', error);        vm.carregando = false;        vm.erro = true;        toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');      });    }  }})();
/** * Enviar Foto Service * @author Leo Brescia &lt;leonardo@leobrescia.com.br> * @namespace Casal */(function () {  'use strict';  angular    .module('dashboard')    .service('EnviarFoto', EnviarFoto);  EnviarFoto.$inject = ['$q', '$http', 'RequestAsFormPost'];  /**   * @memberof dashboard   * @ngdoc service   * @scope {}   * @name EnviarFoto   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Pasta de origem: app/casal. Usado somente na pagina de casal &lt;br>   * Envia a foto do casal recortada para o servidor.&lt;br>   * Envia a foto para o script https://celebri.com.br/celebri/web/uploadFotoCasal.aspx   * @param {service} $q                - usado para promise   * @param {service} $http             - usado para requisicao   * @param {service} RequestAsFormPost - transforma a requisicao em uma requisicao de form   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/services} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#services} Para melhores praticas   */  function EnviarFoto($q, $http, RequestAsFormPost) {    var service = {      Request: Request    };    return service;    ////////////////    /**     * @function Request     * @memberof EnviarFoto     * @desc Cria e retorna uma promise para a solicitação ao servidor     * @param {string} nome - Id do Casal     * @param {image} img   - Imagem na base64     * @returns {Promise} Dados do envio     */    function Request(nome, img) {      var call;      var deferred = $q.defer();      var data = {        'image': img,        'name': nome      };      call = SendData(data);      call.then(function successCallback(response) {        deferred.resolve(response);      }, function errorCallback(response) {        deferred.reject(arguments);      });      return deferred.promise;    }    /**     * @function SendData     * @memberof EnviarFoto     * @desc Envia os dados ao servidor     * @param {JSON} Data - Dados para serem enviados ao servidor     * @returns {Object} Resposta do $http     */    function SendData(Data) {      var requisicao = $http({        method: 'POST',        url: 'https://celebri.com.br/celebri/web/uploadFotoCasal.aspx',        transformRequest: RequestAsFormPost.TransformRequest,        headers: {          'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8'        },        data: Data      });      return requisicao;    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .controller('CadastrarConvidadoController', CadastrarConvidadoController);  CadastrarConvidadoController.$inject = ['serverService', 'conversorService', 'ListManagerService', 'session', '$rootScope', 'toastr'];  /**   * @todo Selecionar mais de um convidado para excluir   * @todo Subir lista atraves de uma planilha   * @memberof dashboard   * @ngdoc controller   * @scope {}   * @name CadastrarConvidadoController   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Cadastra e exclui convidados.&lt;br>   * Pasta de origem : app/convidado &lt;br>   * State : cadastrarConvidados &lt;br>   * Controller As : convidados&lt;br>   * Template Url : app/convidado/cadastrar.html &lt;br>&lt;br>   * Usa o(s) serviço(s) do servidor:   *  - CadastroConvidados {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/CadastroConvidados}   *  - ExcluirConvidados  {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/ExcluirConvidados}   *  - RetornarConvidados {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/RetornarConvidados}   * @param {service} serverService        - usado para comunicar com o servidor (server.service.js)   * @param {service} conversorService     - usado para converter xml &lt;-> json (conversor.service.js)   * @param {service} ListManagerService   - gerencia listas. Passa um object de uma lista para outra (list.service.js)   * @param {service} session              - usado para armazenar e buscar dados no session (session.service.js)   * @param {service} $rootScope           - scope geral   * @param {service} toastr               - usado para mostrar mensagens ao usuario   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/controller} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#controllers} Para melhores praticas   * @see Veja [Servidor Help]  {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help} Para saber sobre os serviços do servidor   */  function CadastrarConvidadoController(serverService, conversorService, ListManagerService, session, $rootScope, toastr) {    const enable = $rootScope.pagante; // Impede de cadastrar, caso não seja pagante    const ID = session.user.id; //Id do usuario logado. Usado para requisições    var vm = this;    vm.carregando = true; //Controla o loading    vm.pessoas = []; //Lista de convidados cadastrados    //Formato do servico CadastroConvidados do servidor    vm.dados = {      'Convidado': {        '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',        'ConvidadoSomenteCerimonia': false,        'ConviteEnviado': false,        'Email': '',        'Id': 0,        'Id_usuario_logado': ID,        'Nome': '',        'Padrinho': false,        'Qtde_Acompanhantes': 0,        'SaveTheDateEnviado': false,        'Senha': ''      }    };    /**     * Atribuição das funçoes as variaveis do escopo     */    vm.Adicionar = Adicionar;    vm.Excluir = Excluir;    Activate();    ////////////////    /**     * @function Activate     * @desc Setup docontrolador. Exetuca assim que o controlador inicia     * @memberof CadastrarConvidadoController     */    function Activate() {      GetDados();    }    /**     * @function Adicionar     * @desc Adiciona um convidado e chama GetDados, para pegar o id do novo adicionado     * @memberof CadastrarConvidadoController     */    function Adicionar() {      //So adiciona um novo convidados se o usuario tiver pago      if (enable) {        var dados = conversorService.Json2Xml(vm.dados, '');        serverService.Request('CadastroConvidados', dados).then(function (resp) {          //Limpa os campos          vm.dados.Convidado.Nome = '';          vm.dados.Convidado.Email = '';          vm.dados.Convidado.Qtde_Acompanhantes = 0;          toastr.success('Convidado Adicionado');          /**           * Depois de adicionar o convidado eh necessario busar as informações           * do servidor novamente. Isso eh feito para pegar o id do novo convidado adicionado           */          GetDados();        }).catch(function (error) {          //Mostra mensagem de erro se houver algum erro ao conectar ao servidor          console.error('CadastroConvidados -> ', error);          vm.carregando = false;          vm.erro = true;          toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');        });      } else {        toastr.error('Você deve efetuar o pagamento para usar essa funcionalidade');      }    }    /**     * @function Excluir     * @param {int|string} id - Id do convidado para deletar     * @desc Exclui o convidado     * @memberof CadastrarConvidadoController     */    function Excluir(id) {      vm.carregando = true;      //Formato do servico ExcluirConvidados do servidor      var item = {        'ListaRegistrosExcluir': {          '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',          'Id_casal': ID,          'Id_registro': {            'int': [{              '#text': id,              '@xmlns': 'http://schemas.microsoft.com/2003/10/Serialization/Arrays'            }]          }        }      };      var dado = conversorService.Json2Xml(item, '');      serverService.Request('ExcluirConvidados', dado).then(function (resp) {        vm.carregando = false;        toastr.success('Convidado Excluido');        GetDados();      }).catch(function (error) {        //Mostra mensagem de erro se houver algum erro ao conectar ao servidor        console.error('ExcluirConvidados -> ', error);        vm.carregando = false;        vm.erro = true;        toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');      });    }    /**     * @function GetDados     * @desc Pega todos os convidados cadastrados do servidor     * @memberof CadastrarConvidadoController     */    function GetDados() {      vm.carregando = true;      vm.pessoas = [];      serverService.Get('RetornarConvidados', ID).then(function (resp) {        /**         * O servico conversorService retorna uma string         * O angular converte de string para objeto         */        resp = angular.fromJson(conversorService.Xml2Json(resp.data, ''));        /**         * Se nao houver convidados cadastrados a variavel resp.ArrayOfConvidado.Convidado         * eh undefined. Por isso eh preciso verificar se existe.         */        if (resp.ArrayOfConvidado.Convidado) {          /**           * Se houver apenas um convidado, o servico conversorService nao gera um array           * portanto a variavel Convidado dentro de resp.ArrayOfConvidado não ira existir           */          if (resp.ArrayOfConvidado.Convidado.length > 1) {            vm.pessoas = resp.ArrayOfConvidado.Convidado;          } else {            vm.pessoas = resp.ArrayOfConvidado;          }        }        vm.carregando = false;        /**         * Campos desnecessarios que aparecem quando faz a conversao de xml para json         * Com eles na variavel eh possivel haver erro         */        delete vm.pessoas['@xmlns'];        delete vm.pessoas['@xmlns:i'];      }).catch(function (error) {        //Mostra mensagem de erro se houver algum erro ao conectar ao servidor        console.error('RetornarConvidados -> ', error);        vm.carregando = false;        vm.erro = true;        toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');      });    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .controller('ConvidadosConfirmadosController', ConvidadosConfirmadosController);  ConvidadosConfirmadosController.inject = ['serverService', 'conversorService', 'session'];  /**   * @todo Baixar lista   * @todo Enviar lista por e-mail   * @memberof dashboard   * @ngdoc controller   * @scope {}   * @name ConvidadosConfirmadosController   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Retorna uma lista com os convidados cadastrados.&lt;br>   * Pasta de origem : app/convidado &lt;br>   * State : convidadosConfirmados &lt;br>   * Controller As : convidados &lt;br>   * Template Url : app/convidado/confirmados.html &lt;br>&lt;br>   * Usa o(s) serviço(s) do servidor:   *  - RetornarConvidadosConfirmados {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/RetornarConvidadosConfirmados}   * @param {service} serverService    - usado para comunicar com o servidor (server.service.js)   * @param {service} conversorService - usado para converter xml &lt;-> json (conversor.service.js)   * @param {service} session          - usado para armazenar e buscar dados no session (session.service.js)   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/controller} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#controllers} Para melhores praticas   * @see Veja [Servidor Help]  {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help} Para saber sobre os serviços do servidor   */  function ConvidadosConfirmadosController(serverService, conversorService, session) {    const ID = session.user.id; //Id do usuario logado. Usado para fazer requisições    var vm = this;    Activate();    ////////////////    /**     * @function Activate     * @desc Setup docontrolador. Exetuca assim que o controlador inicia     * @memberof ConvidadosConfirmadosController     */    function Activate() {      GetDados();    }    /**     * @function GetDados     * @desc Busca a lista de confirmados no servidor     * @memberof ConvidadosConfirmadosController     */    function GetDados() {      serverService.Get('RetornarConvidadosConfirmados', ID).then(function (resp) {        resp = angular.fromJson(conversorService.Xml2Json(resp.data, ''));        /**         * Se nao houver convidados confirmados a variavel resp.ArrayOfListaConvidadosConfirmados.ListaConvidadosConfirmados         * eh undefined. Por isso eh preciso verificar se existe.         */        if (resp.ArrayOfListaConvidadosConfirmados.ListaConvidadosConfirmados) {          /**           * Se houver apenas um convidado, o servico conversorService nao gera um array           * portanto a variavel ListaConvidadosConfirmados dentro de resp.ArrayOfListaConvidadosConfirmados não podera           * ser atribuida a uma outra variavel. Portanto eh preciso usar push nesse caso.           */          if (resp.ArrayOfListaConvidadosConfirmados.ListaConvidadosConfirmados.length > 1) {            vm.pessoas = resp.ArrayOfListaConvidadosConfirmados.ListaConvidadosConfirmados;          } else {            vm.pessoas.push(resp.ArrayOfListaConvidadosConfirmados.ListaConvidadosConfirmados);          }        }      });    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .controller('EnviarConviteController', EnviarConviteController);  EnviarConviteController.inject = ['serverService', 'conversorService', 'ListManagerService', 'session', 'toastr'];  /**   * @memberof dashboard   * @ngdoc controller   * @scope {}   * @name EnviarConviteController   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Envia o convite para os convidados selecionados.&lt;br>   * Pasta de origem : app/convite &lt;br>   * State : enviarConvite &lt;br>   * Controller As : enviar &lt;br>   * Template Url : app/convite/enviar.html &lt;br>&lt;br>   * Usa o(s) serviço(s) do servidor:   *  - EnvioEmailConvite {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/EnvioEmailConvite}   *  - RetornarConvidados {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/RetornarConvidados}   * @param {service} serverService       - usado para comunicar com o servidor (server.service.js)   * @param {service} conversorService    - usado para converter xml &lt;-> json (conversor.service.js)   * @param {service} ListManagerService  - gerencia listas. Passa um object de uma lista para outra (list.service.js)   * @param {service} session             - usado para armazenar e buscar dados no session (session.service.js)   * @param {service} toastr              - usado para mostrar mensagens ao usuario   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/controller} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#controllers} Para melhores praticas   * @see Veja [Servidor Help]  {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help} Para saber sobre os serviços do servidor   */  function EnviarConviteController(serverService, conversorService, ListManagerService, session, toastr) {    const ID = session.user.id; //Id do usuario logado. Usado para fazer requisições    var vm = this;    vm.carregando = true; //Controla o loading    vm.convidados = []; // Lista de convidados cadastrados    vm.erro = false; // Mostra msg de erro, caso haja erro ao conectar ao servidor    vm.ListManager = ListManagerService; // Atribuindo serviço ao escopo    vm.selecionados = []; //Convidados selecionados para envio do convite    /**     * Atribuição das funçoes as variaveis do escopo     */    vm.Enviar = Enviar;    Activate();    ////////////////    /**     * @function Activate     * @desc Setup docontrolador. Exetuca assim que o controlador inicia     * @memberof EnviarConviteController     */    function Activate() {      GetDados();    }    /**     * @function Enviar     * @desc Pega os ids dos convidados da lista selecionados e envia para o servidor para enviar o convite     * @memberof EnviarConviteController     */    function Enviar() {      vm.carregando = true; //Ativa o loading      //Formato de envio para o servidor      var lista = {        'ListaEmailConvidados': {          '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',          'Id_casal': ID,          'Id_convidado': {            'int': []          }        }      };      var xml = null;      //Passa por toda a lista de convidados selecionados e pega o id de cada um      angular.forEach(vm.selecionados, function (selecionado) {        lista.ListaEmailConvidados.Id_convidado.int.push({          '@xmlns': 'http://schemas.microsoft.com/2003/10/Serialization/Arrays',          '#text': selecionado.Id        });      });      xml = conversorService.Json2Xml(lista, ''); //Converte o json para xml      serverService.Request('EnvioEmailConvite', xml).then(function (resp) {        vm.carregando = false;        toastr.success('Convite Enviado!');        /**         * Eh preciso pegar todos os convidados novamente para pegar o status de envio         * que provavelmente deve ter mudado depois do envio.         * Isso tambem limpa a lista de selecionados.         */        GetDados();      }).catch(function (error) {        /**         * Esse bloco eh executado caso haja algum erro no envio de dados para o servidor         */        console.error('RetornarFormatacaoSaveTheDate -> ', error);        vm.carregando = false;        vm.erro = true;        toastr.error('Não foi possível enviar os convites', 'Erro');      });    }    /**     * @function GetDados     * @desc Pega a lista de convidados do servidor     * @memberof EnviarConviteController     */    function GetDados() {      vm.carregando = true; //Ativa o loading      vm.convidados = []; //Limpa a lisa de convidados. Para prevenir erro      vm.selecionados = []; //Limpa a lisa de convidados selecionados. Para prevenir erro      serverService.Get('RetornarConvidados', ID).then(function (resp) {        resp = angular.fromJson(conversorService.Xml2Json(resp.data, ''));        /**         * Se nao houver convidados cadastrados a variavel resp.ArrayOfConvidado.Convidado         * eh undefined. Por isso eh preciso verificar se existe.         */        if (resp.ArrayOfConvidado.Convidado) {          /**           * Se houver apenas um convidado, o servico conversorService nao gera um array           * portanto a variavel Convidado dentro de resp.ArrayOfConvidado não ira existir           */          if (resp.ArrayOfConvidado.Convidado.length > 1) {            vm.convidados = resp.ArrayOfConvidado.Convidado;          } else {            vm.convidados.push(resp.ArrayOfConvidado.Convidado);          }        }        vm.carregando = false;        /**         * Depois da conversao esses campos sao criados         * e gera erro quando faz a reversao da conversao.         * Por isso eh preciso deletar         */        delete vm.convidados['@xmlns'];        delete vm.convidados['@xmlns:i'];      }).catch(function (error) {        /**         * Esse bloco eh executado caso haja algum erro no envio de dados para o servidor         */        console.error('RetornarConvidados -> ', error);        vm.carregando = false;        vm.erro = true;        toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');      });    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .directive('httpPrefix', httpPrefix);  /**   * @memberof dashboard   * @ngdoc directive   * @name httpPrefix   * @desc Adiciona http antes do texto digitado   */  function httpPrefix() {    var httpPrefix = {      link: link,      require: 'ngModel',      restrict: 'A'    };    return httpPrefix;    function link(scope, element, attrs, controller) {      function ensureHttpPrefix(value) {        // Need to add prefix if we don't have http:// prefix already AND we don't have part of it        if (          value &&          !/^(https?):\/\//i.test(value) &&          'http://'.indexOf(value) !== 0 &&          'https://'.indexOf(value) !== 0) {          controller.$setViewValue('http://' + value);          controller.$render();          return 'http://' + value;        } else {          return value;        }      }      controller.$formatters.push(ensureHttpPrefix);      controller.$parsers.splice(0, 0, ensureHttpPrefix);    }  }}());
(function () {  'use strict';  angular    .module('dashboard')    .controller('EstatisticaController', EstatisticaController);  EstatisticaController.$inject = ['serverService', 'conversorService', 'session'];  /**   * @todo fornercer mais informações   * @memberof dashboard   * @ngdoc controller   * @scope {}   * @name EstatisticaController   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Recebe os dados do servidor e monta um grafico utilizando o module chart.js.&lt;br>   * Pasta de origem : app/estatisticas &lt;br>   * State : estatisticas &lt;br>   * Controller As : ctrl&lt;br>   * Template Url : app/estatisticas/estatisticas.html &lt;br>&lt;br>   * Usa o serviço(s) do(s) servidor:   *  - RetornarEstatisticaCasamento {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/RetornarEstatisticaCasamento}   * @param {service} serverService    - usado para comunicar com o servidor (server.service.js)   * @param {service} conversorService - usado para converter xml &lt;-> json (conversor.service.js)   * @param {service} session          - usado para armazenar e buscar dados no session (session.service.js)   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/controller} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#controllers} Para melhores praticas   * @see Veja [Servidor Help]  {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help} Para saber sobre os serviços do servidor   */  function EstatisticaController(serverService, conversorService, session) {    const ID = session.user.id; //id do usuario logado.Usado para fazer requisições    var vm = this;    vm.carregando = true; //Controla o loading    vm.convidadosGeralData = []; //Valores para colocar no grafico    vm.convidadosGeralLabel = []; //Legendas dos valores    vm.dados = {      'DadosEstatisticaCasamento': {        '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',        '@xmlns:i': 'http://www.w3.org/2001/XMLSchema-instance',        'total_acompanhantes': '',        'total_acompanhantes_confirmados': '',        'total_convidados': '',        'total_convidados_confirmados': '',        'total_convidados_somente_cerimonia': '',        'total_convites_enviados_apenas_cerimonia': '',        'total_convites_enviados_cerimonia_e_festa': '',        'total_geral_convidados': '',        'total_geral_convidados_confirmados': '',        'total_save_the_date_enviados': ''      }    };    vm.erro = false;    Activate();    ////////////////    /**     * @function Activate     * @desc Setup docontrolador. Exetuca assim que o controlador inicia     * @memberof EstatisticaController     */    function Activate() {      GetDados();    }    /**     * @function GetDados     * @desc Pega os dados do servidor e envia para o grafico     * @memberof EstatisticaController     */    function GetDados() {      serverService.Get('RetornarEstatisticaCasamento', ID).then(function (resp) {        resp = angular.fromJson(conversorService.Xml2Json(resp.data, ''));        vm.dados = resp;        vm.convidadosGeralLabels = ['Convidados Direto', 'Acompanhantes'];        vm.convidadosGeralData = [resp.DadosEstatisticaCasamento.total_convidados, resp.DadosEstatisticaCasamento.total_acompanhantes];        vm.carregando = false;      }).catch(function (error) {        console.error('RetornarEstatisticaCasamento -> ', error);        vm.carregando = false;        vm.erro = true;      });    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .filter('nospace', NoSpace);  /**   * @memberof dashboard   * @ngdoc filter   * @name NoSpace   * @desc retira todo o espaço de uma string &lt;br>   * Pasta de origem : app/filter   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/api/ng/filter/filter} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#filters} Para melhores praticas   */  function NoSpace() {    return NoSpaceFilter;    ////////////////    /**     * @function NoSpaceFilter     * @memberof NoSpace     * @desc retorna uma string sem espeaço     * @param {string} value     * @return {string}     */    function NoSpaceFilter(value) {      return (!value) ? '' : value.replace(/ /g, '');    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .filter('twoDigits', twoDigits);  /**   * @memberof dashboard   * @ngdoc filter   * @name twoDigits   * @desc deixa um numero decimal com dois digitos &lt;br>   * Pasta de origem : app/filter   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/api/ng/filter/filter} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#filters} Para melhores praticas   */  function twoDigits() {    return twoDigitsFn;    /**     * @function twoDigitsFn     * @memberof twoDigits     * @desc deixa um numero decimal com dois digitos. Ex.: 2 -> 02     * @param {number|string} value     * @return {string}     */    function twoDigitsFn(value) {      var num = parseInt(value, 10);      if (isNaN(num)) {        return value;      }      if (num / 10 &lt; 1) {        num = '0' + num;      }      return num;    }  }}());
(function() {  'use strict';  angular    .module('dashboard')    .filter('yesno', YesNo);  /**   * @memberof dashboard   * @ngdoc filter   * @name YesNo   * @desc troca o valor booleano para sim ou nao &lt;br>   * Pasta de origem : app/filter   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/api/ng/filter/filter} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#filters} Para melhores praticas   */  function YesNo() {    return YesNoFilter;    ////////////////    /**     * @function YesNoFilter     * @memberof YesNo     * @desc troca o valor booleano para sim ou nao     * @param {boolean} value     * @return {string}     */    function YesNoFilter(value) {      return value ? 'sim' : 'não';    }  }})(); 
(function () {  'use strict';  angular    .module('dashboard')    .controller('LoginController', LoginController);  LoginController.$inject = ['serverService', 'conversorService', 'session', '$rootScope', '$state'];  /**   * @memberof dashboard   * @ngdoc controller   * @scope {}   * @name LoginController   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Realiza o processo de login do usuario.&lt;br>   * Pasta de origem : app/login &lt;br>   * State : login &lt;br>   * Controller As : login&lt;br>   * Template Url : app/login/login.html &lt;br>&lt;br>   * Usa o serviço(s) do(s) servidor:   *  - AutenticacaoNoivos {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/AutenticacaoNoivos}   *  - RegistrarPagamentoCelebri {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/RegistrarPagamentoCelebri}   *  - EnviarEmailRecuperacaoSenha {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/EnviarEmailRecuperacaoSenha}   * @param {service} serverService    - usado para comunicar com o servidor (server.service.js)   * @param {service} conversorService - usado para converter xml &lt;-> json (conversor.service.js)   * @param {service} session          - usado para armazenar e buscar dados no session (session.service.js)   * @param {service} $rootScope       - scope geral   * @param {service} $state           - usado para trocar de view   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/controller} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#controllers} Para melhores praticas   * @see Veja [Servidor Help]  {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help} Para saber sobre os serviços do servidor   */  function LoginController(serverService, conversorService, session, $rootScope, $state) {    var vm = this;    vm.carregando = false; //controla o loading    vm.confirmacao = false; // controla msgs quando o usuario solicita a recuperação de senha    //Formato de dados do servidor para autenticar    vm.dados = {      'Autenticacao': {        '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',        'Email': '',        'Senha': ''      }    };    vm.erro = false; //usadado para avisa ao usuario que nao foi possivel acessar o servidor    vm.errorMessage = null;    //Formato de dados do servidor para recuperar senha    vm.recuperar = {      'EmailCasal': {        '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',        'Email': ''      }    };    /**     * Atribuição das funçoes as variaveis do escopo     */    vm.Autenticar = Autenticar;    vm.RecuperarSenha = RecuperarSenha;    Activate();    ////////////////    /**     * @function Activate     * @desc Setup docontrolador. Exetuca assim que o controlador inicia     * @memberof LoginController     */    function Activate() {      $rootScope.pagante = true;      session.user.id = null;      session.SaveState();    }    /**     * @function Autenticar     * @desc Verifica se o usuario esta cadastrado no sistema. Depois verifica se     * é pagante e se o periodo de degustação acabou     * @memberof LoginController     */    function Autenticar() {      vm.carregando = true; //Ativa loading      var xml = conversorService.Json2Xml(vm.dados, '');      serverService.Request('AutenticacaoNoivos', xml).then(function (resp) {        resp = angular.fromJson(conversorService.Xml2Json(resp.data, ''));        //Autenticado        if (!resp.ResultadoAutenticacaoNoivos.ErrorMessage) {          //Guarda as informações do casal e usuario          session.user.id = resp.ResultadoAutenticacaoNoivos.Id_usuario_logado;          session.user.casal.nomeNoivo = resp.ResultadoAutenticacaoNoivos.NomeNoivo;          session.user.casal.nomeNoiva = resp.ResultadoAutenticacaoNoivos.NomeNoiva;          session.user.casal.generoNoiva = resp.ResultadoAutenticacaoNoivos.GeneroNoiva;          session.user.casal.generoNoivo = resp.ResultadoAutenticacaoNoivos.GeneroNoivo;          session.user.casal.urlFoto = resp.ResultadoAutenticacaoNoivos.Url_foto;          /**           * Verifica qual do casal esta logado.           * Isso serve para parsonalizar a barra lateral           */          if (resp.ResultadoAutenticacaoNoivos.EmailNoiva === vm.dados.Autenticacao.Email) {            session.user.casal.emailUsuario = resp.ResultadoAutenticacaoNoivos.EmailNoiva;            session.user.casal.nomeUser = resp.ResultadoAutenticacaoNoivos.NomeNoiva;            session.user.casal.senhaApp = resp.ResultadoAutenticacaoNoivos.SenhaNoivaConvidado;          } else {            session.user.casal.emailUsuario = resp.ResultadoAutenticacaoNoivos.EmailNoivo;            session.user.casal.nomeUser = resp.ResultadoAutenticacaoNoivos.NomeNoivo;            session.user.casal.senhaApp = resp.ResultadoAutenticacaoNoivos.SenhaNoivoConvidado;          }          //Verifica se o casal ja subiu alguma foto          if (resp.ResultadoAutenticacaoNoivos.Url_foto === 'NULL') {            session.user.casal.urlFoto = null;          } else {            //Ao adicionar ?+ data atual, efeita que a imagem fique em cache.            var d = new Date();            var h = d.getHours();            var m = d.getMinutes();            session.user.casal.urlFoto = resp.ResultadoAutenticacaoNoivos.Url_foto + '?' + h + ':' + m;          }          CheckPagamento(resp); //Verifica se pagou        } else { // Nao autenticado          vm.errorMessage = resp.ResultadoAutenticacaoNoivos.ErrorMessage;          vm.carregando = false;        }      }).catch(function (error) {        /**         * Esse bloco eh executado caso haja algum erro no envio de dados para o servidor         */        console.error('AutenticacaoNoivos', error);        vm.carregando = false;        vm.erro = true;      });    }    /**     * @function RegistrarPagamnto     * @desc Registra o casal como pagantes     * @param {number} id - Id do casal     * @param {string} origem - origem do pagamento     * @memberof LoginController     */    function RegistrarPagamnto(id, origem) {      var dado = {        'StatusPagamentoCelebri': {          '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',          'IdCasal': id,          'Origem': origem,          'PagtoAprovado': 'true',          'Valor': '185.00'        }      };      var xml = conversorService.Json2Xml(dado, '');      serverService.Request('RegistrarPagamentoCelebri', xml);    }    /**     * @function CheckVencimento     * @desc Calcula a diferença, em dias, entre a data fornecida e a atual     * @param {string} data - data de cadastro do casal     * @return {number}     * @memberof LoginController     */    function CheckVencimento(data) {      data = data.split('/');      var date1 = new Date();      var date2 = new Date(data[2], data[1] - 1, data[0]);      var timeDiff = Math.abs(date2.getTime() - date1.getTime());      var diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24));      return diffDays - 1;    }    /**     * @function CheckPagamento     * @desc Verifica se o usuario pagou     * @param {object} resp - resposta da autenticação     * @memberof LoginController     */    function CheckPagamento(resp) {      var dados = {        'EmailCasal': {          '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',          'Email': vm.dados.Autenticacao.Email        }      };      //Casal nao pagou dentro do dashboard      if (resp.ResultadoAutenticacaoNoivos.Pagamento_realizado === 'false') {        var xml = conversorService.Json2Xml(dados, '');        serverService.Request('RetornarExisteEmailIsentoPagtoCelebri', xml).then(function (dado) {          dado = angular.fromJson(conversorService.Xml2Json(dado.data, ''));          //Casal nao pagou fora do dashboard          if (dado.RetornoExisteEmailIsentoPagtoCelebri.Result === 'false') {            var dias = CheckVencimento(resp.ResultadoAutenticacaoNoivos.DataCadastro);            if (dias &lt; 16) { //Dentro do periodo de degustacao              session.user.usuarioLiberado = $rootScope.liberado = true;              session.user.diasCadastros = $rootScope.dias = dias;              session.user.pagante = $rootScope.pagante = false;              session.SaveState();              GetDataCasamento();            } else { //periodo de degustacao acabou              vm.errorMessage = 'Seu período de degustação acabou';              vm.carregando = false;            }          } else { //casal pagou            /**             * Isso significa que o usuario pagou fora do dashboard             * Por isso eh preciso registrar o pagamento dentro do dashboard             */            RegistrarPagamnto(resp.ResultadoAutenticacaoNoivos.Id_usuario_logado, dado.RetornoExisteEmailIsentoPagtoCelebri.Origem);            session.user.pagante = $rootScope.pagante = true;            GetDataCasamento();          }        });      } else { // Casal pagou        session.user.pagante = $rootScope.pagante = true;        GetDataCasamento();      }    }    /**     * @function GetDataCasamento     * @desc Pega os dados do casal e depois muda para o view casal     * @memberof LoginController     */    function GetDataCasamento() {      serverService.Get('RetornarDadosCadastroNoivos', session.user.id).then(function (resp) {        var dados = angular.fromJson(conversorService.Xml2Json(resp.data, ''));        session.user.casal.dataCasamento = dados.Casal.DataCasamento;        session.SaveState();        vm.carregando = false;        $state.go('casal');      });    }    /**     * @function RecuperarSenha     * @desc Envia um email para o usuario recuperar a senha     * @memberof LoginController     */    function RecuperarSenha() {      vm.carregando = true;      var xml = conversorService.Json2Xml(vm.recuperar, '');      serverService.Request('EnviarEmailRecuperacaoSenha', xml).then(function (resp) {        resp = angular.fromJson(conversorService.Xml2Json(resp.data, ''));        if (resp.ResultadoRecuperacaoSenha.Result === 'False') {          vm.errorMessage = 'E-mail não consta na base de dados';        } else {          vm.confirmacao = true;          vm.recuperar.EmailCasal.Email = '';        }        vm.carregando = false;      }).catch(function (error) {        console.error('EnviarEmailRecuperacaoSenha', error);        vm.carregando = false;        vm.erro = true;      });    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .controller('PagamentoController', PagamentoController);  PagamentoController.$inject = ['serverService', 'conversorService', 'Cielo', 'session', 'consultCEP', 'toastr', '$rootScope', 'EnviarEmail'];  /**   * @memberof dashboard   * @ngdoc controller   * @scope {}   * @name PagamentoController   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc realiza o processo de pagamento do celebri.&lt;br>   * Pasta de origem : app/pagamento &lt;br>   * State : pagamento &lt;br>   * Controller As : pgto&lt;br>   * Template Url : app/pagamento/pagamento.html &lt;br>&lt;br>   * Usa o serviço(s) do(s) servidor:   *  - AtualizarStatusPagamentoCelebri {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/AtualizarStatusPagamentoCelebri}   *  - RegistrarPagamentoCelebri {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/RegistrarPagamentoCelebri}   *  - CadastrarDadosNotaFiscal {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/CadastrarDadosNotaFiscal}   * @param {service} serverService    - usado para comunicar com o servidor (server.service.js)   * @param {service} conversorService - usado para converter xml &lt;-> json (conversor.service.js)   * @param {service} Cielo            - serviço de pagamento da cielo   * @param {service} session          - usado para armazenar e buscar dados no session (session.service.js)   * @param {service} consultCEP       - serviço para consulta de cep   * @param {service} toastr           - notificações para os usuarios   * @param {service} $rootScope       - scope geral   * @param {service} EnviarEmail      - serviço para envio de email   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/controller} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#controllers} Para melhores praticas   * @see Veja [Servidor Help]  {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help} Para saber sobre os serviços do servidor   */  function PagamentoController(serverService, conversorService, Cielo, session, consultCEP, toastr, $rootScope, EnviarEmail) {    const ID = session.user.id; //Id do casal    var vm = this;    //Dados do cartao de credito    vm.cartao = {      'numero': '',      'validade': '',      'indicador': '',      'codigo': '',      'bandeira': ''    };    vm.carregando = false; //Controla o loading    //Dados do usuario pagante    vm.dados = {      'nome': '',      'cep': '',      'endereco': '',      'bairro': '',      'cidade': '',      'estado': '',      'numero': ''    };    vm.erro = false;    //Dados para nota fiscal    vm.fiscal = {      'DadosNotaFiscal': {        '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',        'Cpf': '',        'Email': '',        'Endereco': '',        'Id_Casal': ID,        'Nome': ''      }    };    /**     * Atribuição das funçoes as variaveis do escopo     */    vm.ConsultCEP = ConsultCEP;    vm.Pagar = Pagar;    Activate();    ////////////////    /**     * @function Activate     * @desc Setup docontrolador. Exetuca assim que o controlador inicia     * @memberof PagamentoController     */    function Activate() {      $('.cartao').validateCreditCard(function (result) {        var cardName = null;        try {          cardName = result.card_type.name;        } catch (error) {          $('.cartao').css('background-position', '99% 4px');        }        switch (cardName) {          case null:            $('.cartao').css('background-position', '99% 4px');            break;          case 'mastercard':            $('.cartao').css('background-position', '99% -106px');            break;          case 'visa':            $('.cartao').css('background-position', '99% -31px');            break;          case 'visa_electron':            $('.cartao').css('background-position', '99% -69px');            break;          default:            $('.cartao').css('background-position', '99% -143px');            break;        }        vm.cartao.bandeira = cardName;      });    }    /**     * @function AtualizarStatus     * @desc Atualiza o status de pagamento do casal     * @param {strong} status - Status do pagamento     * @param {boolean} aprovacao - se foi pago ou nao     * @param {strong} cod - codigo da transação     * @memberof PagamentoController     */    function AtualizarStatus(status, aprovacao, cod) {      var dado = {        'StatusPagamentoCelebri': {          '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',          'CodTransacao': cod,          'IdCasal': ID,          'PagtoAprovado': aprovacao,          'Status': status        }      };      var xml = conversorService.Json2Xml(dado, '');      serverService.Request('AtualizarStatusPagamentoCelebri', xml);    }    /**     * @function ConsultCEP     * @desc Usa o serviço consultCEP para procurar o endeço do cep digitado. E entao preenche o formulario     * @memberof PagamentoController     */    function ConsultCEP() {      consultCEP.consultar(vm.dados.cep).then(function (resp) {        vm.dados.endereco = resp.logradouro;        vm.dados.bairro = resp.bairro;        vm.dados.cidade = resp.cidade;        vm.dados.estado = resp.estado;      });    }    /**     * @function Email     * @desc Envia um email para gustavo@pixla.com.br e bernardo@pixla.com.br com os dados de quem pagou     * @memberof PagamentoController     */    function Email() {      var conteudo = 'Pagamento realizado &lt;br> &lt;table>  &lt;tr>    &lt;td>ID&lt;/td>    &lt;td>' + ID + '&lt;/td>  &lt;/tr>  &lt;tr>    &lt;td>Casal&lt;/td>    &lt;td>' + session.user.casal.nomeNoiva + ' e ' + session.user.casal.nomeNoivo + '&lt;/td>  &lt;/tr>  &lt;tr>    &lt;td>Casamento&lt;/td>    &lt;td>' + session.user.casal.dataCasamento + '&lt;/td>  &lt;/tr>  &lt;tr>    &lt;td>Email&lt;/td>    &lt;td>' + session.user.casal.emailUsuario + '&lt;/td>  &lt;/tr>  &lt;/table>';      EnviarEmail.Mail('gustavo@pixla.com.br', 'Status Pagamento [Dashboard]', conteudo);      EnviarEmail.Mail('bernardo@pixla.com.br', 'Status Pagamento [Dashboard]', conteudo);    }    /**     * @function Pagar     * @desc Envia os dados de pagamento para a cielo     * @memberof PagamentoController     */    function Pagar() {      vm.carregando = true;      /**       * O padrao da data de vencimento da cielo eh       * ano mes( ex. 201612)       */      var vencimento = vm.cartao.validade.split('/');      vencimento = '20' + vencimento[1] + vencimento[0];      Cielo.Send(vm.cartao.numero, vencimento, vm.cartao.codigo, vm.cartao.bandeira).then(function (resp) {        var aprovado = 'false';        var status = '';        var codigo = 0;        var tid = '';        /**         * O servico conversorService retorna uma string         * O angular converte de string para objeto         */        resp = angular.fromJson(conversorService.Xml2Json(resp.data, ''));        codigo = resp.transacao.status;        if (codigo === '4' || codigo === '6') { //Codigo 4 ou 6 significa que esta td ok          //Libera o dashboard          $rootScope.pagante = true;          $rootScope.liberado = true;          toastr.success('Pagamento Realizado!');          //Dados para registrar a transação          aprovado = 'true';          status = 'Transação autorizada';          tid = resp.transacao.tid;          RegistrarNotaFiscal();          RegistrarPagamento(aprovado);          Email();          RegistrarRD();          //Google Analytics          ga('send', 'event', 'pagamento', 'clique');          //Limpa os campos          vm.dados.nome = '';          vm.fiscal.Cpf = '';          vm.fiscal.Email = '';          vm.dados.endereco = '';          vm.dados.cep = '';          vm.dados.bairro = '';          vm.dados.numero = '';          vm.dados.cidade = '';          vm.dados.estado = '';          vm.cartao.numero = '';          vm.cartao.validade = '';          vm.cartao.codigo = '';        } else { // transacao nao autorizada          aprovado = 'false';          toastr.error('Autorização negada');          status = 'Autorização negada';        }        vm.carregando = false;        AtualizarStatus(status, aprovado, tid);      }).catch(function (error) {        /**         * Esse bloco eh executado caso haja algum erro no envio de dados para o servidor         */        console.error('AtualizarDadosCadastroNoivos -> ', error);        vm.carregando = false;        vm.erro = true;        toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');      });    }    /**     * @function RegistrarNotaFiscal     * @desc Registrada os dados do pagamento para efetuar a nota fiscal     * @memberof PagamentoController     */    function RegistrarNotaFiscal() {      vm.fiscal.DadosNotaFiscal.Endereco = vm.dados.endereco + ', ' + vm.dados.numero + ' - ' + vm.dados.bairro + ', ' + vm.dados.cidade + ' - ' + vm.dados.estado;      vm.fiscal.DadosNotaFiscal.Nome = vm.dados.nome;      var xml = conversorService.Json2Xml(vm.fiscal, '');      serverService.Request('CadastrarDadosNotaFiscal', xml);    }    /**     * @function RegistrarPagamento     * @desc Registra que o pagamento foi feito no dashboard.     * Pagamentos podem ser feitos fora do dashboard     * @memberof PagamentoController     */    function RegistrarPagamento(aprovacao) {      var dado = {        'DadosPagamentoCelebri': {          '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',          'IdCasal': ID,          'Origem': 'Dashboard',          'PagtoAprovado': aprovacao,          'Valor': '185.00'        }      };      var xml = conversorService.Json2Xml(dado, '');      serverService.Request('RegistrarPagamentoCelebri', xml).then(function (resp) {});    }    /**     * @function RegistrarRD     * @desc Registra quem pagou no sistema do RD Station     * @memberof PagamentoController     */    function RegistrarRD() {      //Registra o token e o formulario para o qual vai a informacao      RdIntegration.integrate('19182991894ae673fc83ae31d1c0134a', 'pagamento-dashboard');      //Armazena os dados em um array para ser enviado ao RD Station      var dataArray = [{          name: 'email',          value: session.user.casal.emailUsuario        },        {          name: 'identificador',          value: 'pagamento-dashboard'        },        {          name: 'nome',          value: session.user.casal.nomeUser        },        {          name: 'token_rdstation',          value: '19182991894ae673fc83ae31d1c0134a'        }      ];      //Envia os dados para o RD      RdIntegration.post(dataArray);    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .factory('consultCEP', consultCEP);  consultCEP.$inject = ['$q'];  /**   * @memberof dashboard   * @ngdoc factory   * @name consultCEP   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @param {service} $q - promise   * @desc Serviço de consulta de CEP   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/providers#factory-recipe} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#factories} Para melhores praticas   */  function consultCEP($q) {    return {      consultar: Consultar    };    /**     * @function Consultar     * @desc Consulta o cep fornecido e retorna os dados do local     * @see {@link http://postmon.com.br/}     * @param {String} cepToConsult - CEP para consultar     * @memberof consultCEP     */    function Consultar(cepToConsult) {      var cep = cepToConsult.replace(/\./g, '');      cep = cep.replace(/\-/g, '');      var deferred = $q.defer();      if (cep.length > 7) {        var call = $.ajax({          url: 'https://api.postmon.com.br/v1/cep/' + cep        });        call.then(function successCallback(response) {          deferred.resolve(response);        }, function errorCallback(response) {          deferred.reject(arguments);        });        return deferred.promise;      } else {        return '';      }    }  }}());
/** * Teste: * https://qaseCommerce.cielo.com.br/servicos/ecommwsec.do * numero:1006993069 * chave: 25fbb99741c739dd84d7b06ec78c9bac718838630f30b112d033ce2e621b34f3 * ****************************************************************************** * Producao: * https://ecommerce.cielo.com.br/servicos/ecommwsec.do * numero:1078465263 * chave: 2148f89a6778fa1f00a77c89d79e4c516ab0e765a37ed5c51c98167e72672880 */(function () {  'use strict';  angular    .module('dashboard')    .service('Cielo', Cielo);  Cielo.$inject = ['$q', '$http', 'RequestAsFormPost', '$filter'];  /**   * @memberof dashboard   * @ngdoc service   * @name Cielo   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @param {service} $q                - promise   * @param {service} $http             - usado para requisição   * @param {service} RequestAsFormPost - transformar requisição em uma requisição form post   * @param {service} $filter           - transformar alguns texto   * @desc Serviço de consulta de CEP   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/services} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#services} Para melhores praticas   * @see Veja [Cielo DOC]      {@link https://developercielo.github.io/Webservice-1.5/}   */  function Cielo($q, $http, RequestAsFormPost, $filter) {    var appid = '60e74b56ffa91185c5fc8732e94cbb1e';    var token = 'ea7021f308d7d4e691093dc16f6a8c8d';    this.Send = Send;    /**     * @function Send     * @desc monta o xml da requisição da cielo e envia.     * @param {String} numero - numero do cartao     * @param {String} validade - validade do cartao     * @param {String} seguranca - codigo de segurança do cartao     * @param {String} bandeira - bandeira do cartao     * @return {promise}     * @memberof Cielo     */    function Send(numero, validade, seguranca, bandeira) {      var call;      var deferred = $q.defer();      var d = new Date();      var horaLocal = d.getFullYear() + '-' + $filter('twoDigits')(d.getMonth() + 1) + '-' + $filter('twoDigits')(d.getDate()) + 'T' + $filter('twoDigits')(d.getHours()) + ':' + $filter('twoDigits')(d.getMinutes()) + ':' + $filter('twoDigits')(d.getSeconds()) + '.109-03:00';      var xml = 'mensagem=&lt;?xml version="1.0" ?>&lt;requisicao-transacao id="a97ab62a-7956-41ea-b03f-c2e9f612c293" versao="1.2.1">&lt;dados-ec>&lt;numero>1078465263&lt;/numero>&lt;chave>2148f89a6778fa1f00a77c89d79e4c516ab0e765a37ed5c51c98167e72672880&lt;/chave>&lt;/dados-ec>&lt;dados-portador>&lt;numero>' + numero + '&lt;/numero>&lt;validade>' + validade + '&lt;/validade>&lt;indicador>1&lt;/indicador>&lt;codigo-seguranca>' + seguranca + '&lt;/codigo-seguranca>&lt;/dados-portador>&lt;dados-pedido>&lt;numero>178148599&lt;/numero>    &lt;valor>18500&lt;/valor>&lt;moeda>986&lt;/moeda>&lt;data-hora>' + horaLocal + '&lt;/data-hora>&lt;idioma>PT&lt;/idioma>&lt;/dados-pedido>&lt;forma-pagamento>&lt;bandeira>' + bandeira + '&lt;/bandeira>    &lt;produto>1&lt;/produto>&lt;parcelas>1&lt;/parcelas>&lt;/forma-pagamento>  &lt;autorizar>3&lt;/autorizar>&lt;capturar>true&lt;/capturar>&lt;gerar-token>true&lt;/gerar-token>&lt;/requisicao-transacao>';      var data = {        'url': 'https://ecommerce.cielo.com.br/servicos/ecommwsec.do',        'xml': xml      };      call = SendData(data);      call.then(function successCallback(response) {        deferred.resolve(response);      }, function errorCallback(response) {        deferred.reject(arguments);      });      return deferred.promise;    }    /**     * @function SendData     * @desc realiza requisição     * @param {json} Data - dados para requisição     * @return {object}     * @memberof Cielo     */    function SendData(Data) {      var requisicao = $http({        method: 'POST',        url: 'https://celebri.com.br/celebri/web/request_cielo.aspx',        transformRequest: RequestAsFormPost.TransformRequest,        headers: {          'Content-Type': 'application/x-www-form-urlencoded;charset=ISO-8859-1'        },        data: Data      });      return requisicao;    }  }}());
(function () {  'use strict';  angular    .module('dashboard')    .service('conversorService', conversorService);  conversorService.$inject = [];  /**   * @memberof dashboard   * @ngdoc service   * @name conversorService   * @author  Stefan Goessner   * @license Creative Commons GNU LGPL   * @version 0.9   * @desc Faz a transformação entre xml e json   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/services} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#services} Para melhores praticas   * @see License               {@link http://creativecommons.org/licenses/LGPL/2.1/}   * @see Author site           {@link  http://goessner.net/}   */  function conversorService() {    this.Json2Xml = Json2Xml;    this.Xml2Json = Xml2Json;    ////////////////    /**     * @function Json2Xml     * @desc Consulta o cep fornecido e retorna os dados do local     * @param {object} o - javascript object     * @param {String} tab - tab or indent string for pretty output formatting.Omit or use empty string "" to supress.     * @return {xml} xml string     * @memberof conversorService     */    function Json2Xml(o, tab) {      o = angular.fromJson(o);      var toXml = function (v, name, ind) {          var xml = "";          if (v instanceof Array) {            for (var i = 0, n = v.length; i &lt; n; i++)              xml += ind + toXml(v[i], name, ind + "\t") + "\n";          } else if (typeof (v) == "object") {            var hasChild = false;            xml += ind + "&lt;" + name;            for (var m in v) {              if (m.charAt(0) == "@")                xml += " " + m.substr(1) + "=\"" + v[m].toString() + "\"";              else                hasChild = true;            }            xml += hasChild ? ">" : "/>";            if (hasChild) {              for (var m in v) {                if (m == "#text")                  xml += v[m];                else if (m == "#cdata")                  xml += "&lt;![CDATA[" + v[m] + "]]>";                else if (m.charAt(0) != "@")                  xml += toXml(v[m], m, ind + "\t");              }              xml += (xml.charAt(xml.length - 1) == "\n" ? ind : "") + "&lt;/" + name + ">";            }          } else {            xml += ind + "&lt;" + name + ">" + v.toString() + "&lt;/" + name + ">";          }          return xml;        },        xml = "";      for (var m in o)        xml += toXml(o[m], m, "");      return tab ? xml.replace(/\t/g, tab) : xml.replace(/\t|\n/g, "");    }    /**     * @function String2Object     * @desc transofrma um xml string em xml object     * @param {String} xml - xml string     * @return {xml}     * @memberof conversorService     */    function String2Object(xml) {      var parseXml;      if (window.DOMParser) {        parseXml = function (xmlStr) {          return (new window.DOMParser()).parseFromString(xmlStr, 'text/xml');        };      } else if (typeof window.ActiveXObject != 'undefined' && new window.ActiveXObject('Microsoft.XMLDOM')) {        parseXml = function (xmlStr) {          var xmlDoc = new window.ActiveXObject('Microsoft.XMLDOM');          xmlDoc.async = 'false';          xmlDoc.loadXML(xmlStr);          return xmlDoc;        };      } else {        parseXml = function () {          return null;        }      }      return parseXml(xml);    }    /**     * @function Xml2Json     * @desc Consulta o cep fornecido e retorna os dados do local     * @param {xml} xml - element or document DOM node     * @param {String} tab - tab or indent string for pretty output formatting.Omit or use empty string "" to supress.     * @return {json} json string     * @memberof conversorService     */    function Xml2Json(xml, tab) {      xml = String2Object(xml); //converte de string para objeto      var X = {        toObj: function (xml) {          var o = {};          if (xml.nodeType == 1) { // element node ..            if (xml.attributes.length) // element with attributes  ..              for (var i = 0; i &lt; xml.attributes.length; i++)                o["@" + xml.attributes[i].nodeName] = (xml.attributes[i].nodeValue || "").toString();            if (xml.firstChild) { // element has child nodes ..              var textChild = 0,                cdataChild = 0,                hasElementChild = false;              for (var n = xml.firstChild; n; n = n.nextSibling) {                if (n.nodeType == 1) hasElementChild = true;                else if (n.nodeType == 3 && n.nodeValue.match(/[^ \f\n\r\t\v]/)) textChild++; // non-whitespace text                else if (n.nodeType == 4) cdataChild++; // cdata section node              }              if (hasElementChild) {                if (textChild &lt; 2 && cdataChild &lt; 2) { // structured element with evtl. a single text or/and cdata node ..                  X.removeWhite(xml);                  for (var n = xml.firstChild; n; n = n.nextSibling) {                    if (n.nodeType == 3) // text node                      o["#text"] = X.escape(n.nodeValue);                    else if (n.nodeType == 4) // cdata node                      o["#cdata"] = X.escape(n.nodeValue);                    else if (o[n.nodeName]) { // multiple occurence of element ..                      if (o[n.nodeName] instanceof Array)                        o[n.nodeName][o[n.nodeName].length] = X.toObj(n);                      else                        o[n.nodeName] = [o[n.nodeName], X.toObj(n)];                    } else // first occurence of element..                      o[n.nodeName] = X.toObj(n);                  }                } else { // mixed content                  if (!xml.attributes.length)                    o = X.escape(X.innerXml(xml));                  else                    o["#text"] = X.escape(X.innerXml(xml));                }              } else if (textChild) { // pure text                if (!xml.attributes.length)                  o = X.escape(X.innerXml(xml));                else                  o["#text"] = X.escape(X.innerXml(xml));              } else if (cdataChild) { // cdata                if (cdataChild > 1)                  o = X.escape(X.innerXml(xml));                else                  for (var n = xml.firstChild; n; n = n.nextSibling)                    o["#cdata"] = X.escape(n.nodeValue);              }            }            if (!xml.attributes.length && !xml.firstChild) o = null;          } else if (xml.nodeType == 9) { // document.node            o = X.toObj(xml.documentElement);          } else            alert("unhandled node type: " + xml.nodeType);          return o;        },        toJson: function (o, name, ind) {          var json = name ? ("\"" + name + "\"") : "";          if (o instanceof Array) {            for (var i = 0, n = o.length; i &lt; n; i++)              o[i] = X.toJson(o[i], "", ind + "\t");            json += (name ? ":[" : "[") + (o.length > 1 ? ("\n" + ind + "\t" + o.join(",\n" + ind + "\t") + "\n" + ind) : o.join("")) + "]";          } else if (o == null)            json += (name && ":") + "null";          else if (typeof (o) == "object") {            var arr = [];            for (var m in o)              arr[arr.length] = X.toJson(o[m], m, ind + "\t");            json += (name ? ":{" : "{") + (arr.length > 1 ? ("\n" + ind + "\t" + arr.join(",\n" + ind + "\t") + "\n" + ind) : arr.join("")) + "}";          } else if (typeof (o) == "string")            json += (name && ":") + "\"" + o.toString() + "\"";          else            json += (name && ":") + o.toString();          return json;        },        innerXml: function (node) {          var s = ""          if ("innerHTML" in node)            s = node.innerHTML;          else {            var asXml = function (n) {              var s = "";              if (n.nodeType == 1) {                s += "&lt;" + n.nodeName;                for (var i = 0; i &lt; n.attributes.length; i++)                  s += " " + n.attributes[i].nodeName + "=\"" + (n.attributes[i].nodeValue || "").toString() + "\"";                if (n.firstChild) {                  s += ">";                  for (var c = n.firstChild; c; c = c.nextSibling)                    s += asXml(c);                  s += "&lt;/" + n.nodeName + ">";                } else                  s += "/>";              } else if (n.nodeType == 3)                s += n.nodeValue;              else if (n.nodeType == 4)                s += "&lt;![CDATA[" + n.nodeValue + "]]>";              return s;            };            for (var c = node.firstChild; c; c = c.nextSibling)              s += asXml(c);          }          return s;        },        escape: function (txt) {          return txt.replace(/[\\]/g, "\\\\")            .replace(/[\"]/g, '\\"')            .replace(/[\n]/g, '\\n')            .replace(/[\r]/g, '\\r');        },        removeWhite: function (e) {          e.normalize();          for (var n = e.firstChild; n;) {            if (n.nodeType == 3) { // text node              if (!n.nodeValue.match(/[^ \f\n\r\t\v]/)) { // pure whitespace text node                var nxt = n.nextSibling;                e.removeChild(n);                n = nxt;              } else                n = n.nextSibling;            } else if (n.nodeType == 1) { // element node              X.removeWhite(n);              n = n.nextSibling;            } else // any other node              n = n.nextSibling;          }          return e;        }      };      if (xml.nodeType == 9) // document node        xml = xml.documentElement;      var json = X.toJson(X.toObj(X.removeWhite(xml)), xml.nodeName, "\t");      return "{\n" + tab + (tab ? json.replace(/\t/g, tab) : json.replace(/\t|\n/g, "")) + "\n}";    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .service('EnviarEmail', EnviarEmail);  EnviarEmail.$inject = ['$q', '$http', 'RequestAsFormPost'];  /**   * @memberof dashboard   * @ngdoc service   * @name EnviarEmail   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @param {service} $q                - promise   * @param {service} $http             - usado para requisição   * @param {service} RequestAsFormPost - transformar requisição em uma requisição form post   * @desc Envia um email   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/services} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#services} Para melhores praticas   */  function EnviarEmail($q, $http, RequestAsFormPost) {    this.Mail = Mail;    /**     * @function Mail     * @desc monta o promise e envia o email     * @param {String} destinatario - destinatario do email     * @param {String} assunto - assunto do email     * @param {String} conteudo - conteudo do email     * @return {promise}     * @memberof EnviarEmail     */    function Mail(destinatario, assunto, conteudo) {      var call;      var deferred = $q.defer();      var data = {        'destinatario': destinatario,        'assunto': assunto,        'conteudo': conteudo      };      call = SendData(data);      call.then(function successCallback(response) {        deferred.resolve(response);      }, function errorCallback(response) {        deferred.reject(arguments);      });      return deferred.promise;    }    /**     * @function SendData     * @desc realiza requisição     * @param {json} Data - dados para requisição     * @return {object}     * @memberof EnviarEmail     */    function SendData(Data) {      var requisicao = $http({        method: 'POST',        url: 'https://www.celebri.com.br/celebri/web/enviar_email_generico.aspx',        transformRequest: RequestAsFormPost.TransformRequest,        headers: {          'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8'        },        data: Data      });      return requisicao;    }  }}());
(function () {  'use strict';  angular    .module('dashboard')    .service('ListManagerService', ListManagerService);  /**   * @memberof dashboard   * @ngdoc service   * @name ListManagerService   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Gerencia listas de selecionados. Retirando e colocando itens da lista fornecida   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/services} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#services} Para melhores praticas   */  function ListManagerService() {    this.Exists = Exists;    this.IsIndeterminate = IsIndeterminate;    this.Toggle = Toggle;    this.ToggleAll = ToggleAll;    ////////////////    /**     * @function Exists     * @desc Verifica se o item existe em uma lista fornecida     * @param {Object} item - objeto para verificacao     * @param {Array} selecedList - lista para verificar se contem o item     * @return {Boolean}     * @memberof ListManagerService     */    function Exists(item, selecedList) {      return selecedList.indexOf(item) > -1;    }    /**     * @function IsIndeterminate     * @desc Verifica se a lista de selecionados esta completa     * @param {Array} selecedList - lista dos selecionados     * @param {Array} list - lista contendo todos os itens disponiveis     * @return {Boolean}     * @memberof ListManagerService     */    function IsIndeterminate(selecedList, list) {      return (selecedList.length !== 0 &&        selecedList.length !== list.length);    }    /**     * @function Toggle     * @desc Retira ou coloca o item na lista fornecida     * @param {Object} item - objeto para inclusao/exclusao da lista     * @param {Array} selecedList -lista de selecionados     * @memberof ListManagerService     */    function Toggle(item, selecedList) {      var idx = selecedList.indexOf(item);      if (idx > -1) {        selecedList.splice(idx, 1);      } else {        selecedList.push(item);      }    }    /**     * @function ToggleAll     * @desc Retira ou coloca todos os itens na lista de selecionados     * @param {Array} selecedList - lista dos selecionados     * @param {Array} list - lista contendo todos os itens disponiveis     * @memberof ListManagerService     */    function ToggleAll(selecedList, list) {      if (selecedList.length === list.length) {        selecedList.splice(0, selecedList.length);      } else if (selecedList.length === 0 || selecedList.length > 0) {        selecedList.splice(0, selecedList.length);        angular.forEach(list, function (item) {          selecedList.push(item);        });      }    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .factory('RequestAsFormPost', RequestAsFormPost);  /**   * @memberof dashboard   * @ngdoc factory   * @name RequestAsFormPost   * @desc Transforma o header do request do angular em form post   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/providers#factory-recipe} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#factories} Para melhores praticas   */  function RequestAsFormPost() {    var service = {      TransformRequest: TransformRequest    };    return service;    ////////////////    /**     * @function TransformRequest     * @desc Modifica o header do request     * @param {Object} data     * @param {Function} getHeaders     * @return {String} Header modificado     * @memberof RequestAsFormPost     */    function TransformRequest(data, getHeaders) {      var headers = getHeaders();      headers['Content-type'] = 'application/x-www-form-urlencoded; charset=utf-8';      return (SerializeData(data));    }    /**     * @function SerializeData     * @desc Serializa o header do request     * @param {Object} data - objeto a ser serializado     * @return {String} A data serializada     * @memberof RequestAsFormPost     */    function SerializeData(data) {      if (!angular.isObject(data)) {        return ((data === null) ? '' : data.toString());      }      var buffer = [];      for (var name in data) {        if (!data.hasOwnProperty(name)) {          continue;        }        var value = data[name];        buffer.push(          encodeURIComponent(name) +          '=' +          encodeURIComponent((value === null) ? '' : value)        );      }      var source = buffer        .join('&')        .replace(/%20/g, '+');      return (source);    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .service('serverService', serverService);  serverService.$inject = ['$q', '$http', 'RequestAsFormPost'];  /**   * @memberof dashboard   * @ngdoc service   * @name serverService   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Faz a coneccao com o API Service   * @param {service} $q                - promise   * @param {service} $http             - usado para requisição   * @param {service} RequestAsFormPost - transformar requisição em uma requisição form post   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/services} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#services} Para melhores praticas   */  function serverService($q, $http, RequestAsFormPost) {    var appid = '60e74b56ffa91185c5fc8732e94cbb1e';    var token = 'ea7021f308d7d4e691093dc16f6a8c8d';    var service = {      Get: Get,      Request: Request    };    return service;    ////////////////    /**     * @function Get     * @desc Quando a requisição precisa apenas enviar o id como paramentro, utilize essa função.     * ela monta o xml com o id fornecido e envia a solicitação ao servidor     * @param {String} endpoint - endpoint do servico que deseja acessar     * @param {number} id - id do casal     * @return {Promise}     * @memberof serverService     */    function Get(endpoint, id) {      var xml = '&lt;IdentificaocaoCasal xmlns="http://schemas.datacontract.org/2004/07/WcfServiceCasamento">  &lt;Id_casal>' + id + '&lt;/Id_casal>&lt;/IdentificaocaoCasal>';      return Request(endpoint, xml);    }    /**     * @function Request     * @desc Envia o endpoint e o json da requisicao para a funcao SendData     * @param {String} endpoint - endpoint do servico que deseja acessar     * @param {xml} xml - request Json body     * @return {Promise}     * @memberof serverService     */    function Request(endpoint, xml) {      var call;      var deferred = $q.defer();      var data = {        'uri': 'http://celebri.com.br/celebri/ServiceCasamento.svc/' + endpoint,        'xml': xml,        'appid': appid,        'token': token      };      call = SendData(data);      call.then(function successCallback(response) {        deferred.resolve(response);      }, function errorCallback(response) {        deferred.reject(arguments);      });      return deferred.promise;    }    /**     * @function SendData     * @desc Envia (ajax) um post ao API Service     * @param {Object} Data - data para ser enviado pelo ajax     * @return {String|JSON} Retorna um string em formato json     * @memberof serverService     */    function SendData(Data) {      var requisicao = $http({        method: 'POST',        url: 'https://celebri.com.br/celebri/web/service_request.aspx',        transformRequest: RequestAsFormPost.TransformRequest,        headers: {          'Content-Type': 'application/x-www-form-urlencoded'        },        data: Data      });      return requisicao;    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .factory('session', session);  session.$inject = ['$rootScope', '$state'];  /**   * @memberof dashboard   * @ngdoc factory   * @name session   * @desc Armazena e fornece informações sobre o usuario e casal   * @param {service} $rootScope - scope geral   * @param {service} $state - controle os states   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/providers#factory-recipe} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#factories} Para melhores praticas   */  function session($rootScope, $state) {    var padrao = {      casal: {        'nomeNoivo': '',        'nomeNoiva': '',        'generoNoiva': 'F',        'generoNoivo': 'M',        'urlFoto': '',        'emailUsuario': '',        'nomeUser': '',        'senhaApp': '',        'dataCasamento': ''      },      cerimonia: [],      convite: [],      diasCadastros: 0,      id: null,      pagante: false,      usuarioLiberado: false    };    var service = {      user: padrao,      SaveState: SaveState,      RestoreState: RestoreState,      Remove: Remove    };    $rootScope.$on('savestate', service.SaveState);    $rootScope.$on('restorestate', service.RestoreState);    return service;    ////////////////    /**     * @function SaveState     * @desc Salva o service no session     * @memberof session     */    function SaveState() {      if (service.user === null) {        service.user = padrao;      }      sessionStorage.Session = angular.toJson(service.user);    }    /**     * @function RestoreState     * @desc Restaura o service do session     * @memberof session     */    function RestoreState() {      var dados = angular.fromJson(sessionStorage.Session);      if (dados === undefined || dados === null) {        SaveState();      } else {        service.user = dados;      }    }    /**     * @function Remove     * @desc Remove o service do session     * @memberof session     */    function Remove() {      sessionStorage.removeItem('Session');      $state.go('login');    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .controller('SidebarController', SidebarController);  SidebarController.$inject = ['session', '$state'];  /**   * @memberof dashboard   * @ngdoc controller   * @scope {}   * @name SidebarController   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Controla a barra lateral do dashboard.&lt;br>   * Pasta de origem : app/sidebar &lt;br>   * Controller As : sidebar&lt;br>   * Template Url : app/sidebar/sidebar.html &lt;br>&lt;br>   * @param {service} session    - usado para armazenar e buscar dados no session (session.service.js)   * @param {service} $state - usado para converter xml &lt;-> json (conversor.service.js)   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/controller} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#controllers} Para melhores praticas   */  function SidebarController(session, $state) {    var vm = this;    vm.menu = [{      name: 'Pagamento',      state: 'pagamento',      type: 'link'    }, {      name: 'Casal',      state: 'casal',      type: 'link'    }, {      name: 'Convite',      type: 'toggle',      pages: [{        name: 'Configurar',        state: 'cerimonia',        type: 'link'      }, {        name: 'Save the Date',        state: 'savethedate',        type: 'link'      }, {        name: 'Aplicativo',        state: 'aplicativo',        type: 'link'      }, {        name: 'Enviar',        state: 'enviarConvite',        type: 'link'      }]    }, {      name: 'Informações Adicionais',      type: 'toggle',      pages: [{          name: 'Recepção',          state: 'recepcao',          type: 'link'        }, {          name: 'Dicas de Hotel',          state: 'hotel',          type: 'link'        }, {          name: 'Dicas de Salão de Beleza',          state: 'salao',          type: 'link'        }, {          name: 'Lista de Presentes',          state: 'presentes',          type: 'link'        }, {          name: 'Cardápio',          state: 'cardapio',          type: 'link'        },        {          name: 'Cotas de Lua de Mel',          state: 'cotas',          type: 'link'        }      ]    }, {      name: 'Convidados',      type: 'toggle',      pages: [{        name: 'Cadastrar',        state: 'cadastrarConvidados',        type: 'link'      }, {        name: 'Confirmados',        state: 'convidadosConfirmados',        type: 'link'      }]    }, {      name: 'Estatísticas',      state: 'estatisticas',      type: 'link'    }];    vm.openedSection = null;    vm.userName = session.user.casal.nomeUser;    /**     * Atribuição das funçoes as variaveis do escopo     */    vm.IsSectionSelected = IsSectionSelected;    vm.Sair = Sair;    vm.ToggleSection = ToggleSection;    Activate();    ////////////////    /**     * @function Activate     * @desc Setup docontrolador. Exetuca assim que o controlador inicia     * @memberof SidebarController     */    function Activate() {}    /**     * @function IsSectionSelected     * @desc Verifica se o menu clicado eh o ativo. Serve para alterar a classe do menu     * @param {object} section - section do menu     * @return {boolean}     * @memberof SidebarController     */    function IsSectionSelected(section) {      return vm.openedSection === section;    }    /**     * @function Sair     * @desc Apaga o session do usuario e envia ele para o login     * @memberof SidebarController     */    function Sair() {      session.user.id = null;      session.SaveState();      session.Remove();    }    /**     * @function ToggleSection     * @desc Abre a seção do menu.     * @memberof SidebarController     */    function ToggleSection(section) {      vm.openedSection = (vm.openedSection === section ? null : section);    }  }})();
/** * @namespace Directives */(function () {  'use strict';  angular    .module('dashboard')    .directive('sidebar', SideBar);  /**   * @memberof dashboard   * @ngdoc directive   * @name SideBar   * @desc Retorna o template do cabecalho   */  function SideBar() {    return {      templateUrl: 'app/sidebar/sidebar.html',      restrict: 'AE'    };  }})();
(function () {  'use strict';  angular.module('dashboard')    .run(Run)    .config(Config);  Run.$inject = ['$rootScope', '$state', 'session'];  /**   * @memberof dashboard   * @ngdoc config   * @scope {}   * @name Run   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Exetuca açoes assim que o module eh iniciado.&lt;br>   * Pasta de origem : app/_core &lt;br>   * @param {service} $rootScope  - scope geral   * @param {service} $state      - usado para trocar o titulo do site   * @param {service} session     - usado para armazenar e buscar dados no session (session.service.js)   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/module#run-blocks} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#style-y171} Para melhores praticas   */  function Run($rootScope, $state, session) {    $rootScope.$on('$stateChangeSuccess', ChangeSuccess);    $rootScope.$on('$stateChangeStart', ChangeStart);    /**     * @function ChangeStart     * @desc Executa quando o state comeca a mudar     * @param {event} event     * @param {object} toState     * @param {object} toParams     * @param {object} fromState     * @param {object} fromParams     * @memberof Run     */    function ChangeStart(event, toState, toParams, fromState, fromParams) {      var userAuthenticated = false; //Por padrao o usuario nao esta autenticado      session.RestoreState(); //Carrega os dados do usuario salvos no session      $rootScope.pagante = session.user.pagante; //Controla as funções que o usuario pode fazer      $rootScope.dias = session.user.diasCadastros; //Dias decorridos desde o cadstro      $rootScope.liberado = session.user.usuarioLiberado;      $rootScope.foto = session.user.casal.urlFoto; //A foto do casal eh global pois esta em dois controladores      /**       * Se existir id no session significa que o usuario ja efetuou o login       * O id so vai existir depois do usuario entrar no sistema       */      if (session.user.id) {        userAuthenticated = true;      }      //Se nao estiver autenticado vai para a pagina de login      if (!userAuthenticated && !toState.isLogin) {        event.preventDefault();        $state.go('login');      }      /**       * Verifica se esta na pagina de login        * e esconde a barra lateral       * o isLogin controla isso       */      if (toState.name === 'login') {        $rootScope.isLogin = true;      } else {        $rootScope.isLogin = false;      }    }    /**     * @function ChangeSuccess     * @desc Executa depois que o state mudou     * @memberof Run     */    function ChangeSuccess() {      $rootScope.personalizar = false; //usado para escoder a navegacao lateral      $rootScope.$broadcast('restorestate');      $rootScope.title = $state.current.title; //Change page title, based on Route information      /**       * Verifica se esta na pagina de personalizar o convite       * e escode a navegacao lateral       * a variavel eh usada no arquivo sidebar.html       */      if ($state.current.name === 'personalizar') {        $rootScope.personalizar = true;      }    }  }  Config.$inject = ['$mdDateLocaleProvider'];  /**   * @memberof dashboard   * @ngdoc config   * @scope {}   * @name Config   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Executa configurações quando o mudule eh iniciado.&lt;br>   * Pasta de origem : app/_core &lt;br>   * @param {service} $mdDateLocaleProvider  - servico de data e tempo do datapicker   * @param {service} $state      - usado para trocar o titulo do site   * @param {service} session     - usado para armazenar e buscar dados no session (session.service.js)   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/module#configuration-blocks} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#style-y170} Para melhores praticas   */  function Config($mdDateLocaleProvider) {    /**     * Configura o datapicker para o pt-br utilizando o momentJs     * Referencia: http://momentjs.com/     */    $mdDateLocaleProvider.months = [      'Janeiro', 'Fevereiro', 'Março',      'Abril', 'Maio', 'Junho',      'Julho', 'Agosto', 'Setembro',      'Outubro', 'Novembro', 'Dezembro'    ];    $mdDateLocaleProvider.shortMonths = [      'Jan', 'Fev', 'Mar',      'Abr', 'Mai', 'Jun',      'Jul', 'Ago', 'Set',      'Out', 'Nov', 'Dez'    ];    $mdDateLocaleProvider.days = [      'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta',      'Sábado', 'Domingo'    ];    $mdDateLocaleProvider.shortDays = [      'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sab', 'Dom'    ];    $mdDateLocaleProvider.formatDate = function (date) {      return moment(date).format('DD/MM/YYYY');    };    $mdDateLocaleProvider.parseDate = function (dateString) {      var m = moment(dateString, 'DD/MM/YYYY', true);      return m.isValid() ? m.toDate() : new Date(NaN);    };    $mdDateLocaleProvider.msgCalendar = 'Calendario';    $mdDateLocaleProvider.msgOpenCalendar = 'Abrir calendario';  }})();
(function () {  'use strict';  angular    .module('dashboard')    .controller('MainController', MainController);  MainController.$inject = [];  /**   * @memberof dashboard   * @ngdoc controller   * @scope {}   * @name MainController   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Controlador principal do sistema. Afeta todos os views. Fica localizado no index.html&lt;br>   * Pasta de origem : app/_core &lt;br>   * State :  &lt;br>   * Controller As : main&lt;br>   * Template Url :  &lt;br>&lt;br>   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/controller} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#controllers} Para melhores praticas   */  function MainController() {    var vm = this;    vm.dialogControl = true; //Controla o display do popup que esta na index    vm.GetTimes = GetTimes;    Activate();    ////////////////    /**     * @function Activate     * @desc Setup docontrolador. Exetuca assim que o controlador inicia     * @memberof MainController     */    function Activate() {}    /**     * @function GetTimes     * @desc Usado para executar o ng repeat n vezes     * @param {int} n - Numero de vezes que o ng-repeat deve executar     * @memberof MainController     */    function GetTimes(n) {      return new Array(n);    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .controller('AplicativoController', AplicativoController);  AplicativoController.$inject = ['session'];  /**   * @memberof dashboard   * @ngdoc controller   * @scope {}   * @name AplicativoController   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Mostra a senha do aplicativo de teste para o usuario.&lt;br>   * Pasta de origem : app/convite/aplicativo &lt;br>   * State : aplicativo &lt;br>   * Controller As : app &lt;br>   * Template Url : app/convite/aplicativo/aplicativo.html &lt;br>&lt;br>   * Usa o(s) serviço(s) do servidor:   *   * @param {service} session - usado para armazenar e buscar dados no session (session.service.js)   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/controller} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#controllers} Para melhores praticas   * @see Veja [Servidor Help]  {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help} Para saber sobre os serviços do servidor   */  function AplicativoController(session) {    var vm = this;    vm.senha = session.user.casal.senhaApp;    Activate();    ////////////////    /**     * @function Activate     * @desc Setup docontrolador. Exetuca assim que o controlador inicia     * @memberof AplicativoController     */    function Activate() {}  }})();
(function () {  'use strict';  angular    .module('dashboard')    .controller('CerimoniaController', CerimoniaController);  CerimoniaController.$inject = ['serverService', 'conversorService', 'session', 'toastr', 'consultCEP'];  /**   * @memberof dashboard   * @ngdoc controller   * @scope {}   * @name CerimoniaController   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Recebe, do usuario, dados basicos para a criação do convite.&lt;br>   * Pasta de origem : app/convite/cerimonia &lt;br>   * State : cerimonia &lt;br>   * Controller As : cerimonia &lt;br>   * Template Url : app/convite/cerimonia/cerimonia.html &lt;br>&lt;br>   * Usa o(s) serviço(s) do servidor:   *  - RetornarConfiguracaoConvite {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/RetornarConfiguracaoConvite}   *  - ConfiguracaoConvite {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/ConfiguracaoConvite}   * @param {service} serverService    - usado para comunicar com o servidor (server.service.js)   * @param {service} conversorService - usado para converter xml &lt;-> json (conversor.service.js)   * @param {service} session          - usado para armazenar e buscar dados no session (session.service.js)   * @param {service} toastr           - usado para mostrar mensagens ao usuario   * @param {service} consultCEP       - serviço para consultar cep   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/controller} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#controllers} Para melhores praticas   * @see Veja [Servidor Help]  {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help} Para saber sobre os serviços do servidor   */  function CerimoniaController(serverService, conversorService, session, toastr, consultCEP) {    const ID = session.user.id; //Id do usuario logado.Usado para fazer requisições    var vm = this;    vm.carregando = true;    //Formato do servico ConfiguracaoConvite do servidor    vm.dados = {      'ConfiguracaoConvite': {        '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',        '@xmlns:i': 'http://www.w3.org/2001/XMLSchema-instance',        'Bairro': '',        'Cep': '',        'Cidade': '',        'Endereco': '',        'Estado': '',        'Horario_cerimonia': '',        'Id_usuario_logado': ID,        'Local_cerimonia': '',        'Mae_noiva': '',        'Mae_noiva_in_memoriam': 'false',        'Mae_noivo': '',        'Mae_noivo_in_memoriam': 'false',        'Msg1': 'null',        'Msg2': 'null',        'Msg3': 'null',        'Msg4': 'null',        'Msg5': 'null',        'Msg6': 'null',        'Numero': '',        'Obs': 'null',        'Pai_noiva': '',        'Pai_noiva_in_memoriam': 'false',        'Pai_noivo': '',        'Pai_noivo_in_memoriam': 'false',        'Pais': 'null',        'TemplateConviteApp': '0',        'Tracar_rota_local': 'true'      }    };    vm.erro = false;    //Controla o genero de algumas palavras do formulario    vm.genero = {      'noiva': session.user.casal.generoNoiva,      'noivo': session.user.casal.generoNoivo    };    /**     * O formato enviado para o servidor eh 12:00 por ex.     * Mas no formulario a hora e os min sao separados.     * Por isso eles estao fora do vm.dados     * Antes de enviar eles sao agrupados dentro de vm.dados     */    vm.hora = '';    vm.min = '';    /**     * Atribuição das funçoes as variaveis do escopo     */    vm.Cancelar = GetDados;    vm.ConsultCEP = ConsultCEP;    vm.Salvar = SetDados;    Activate();    ////////////////    /**     * @function Activate     * @desc Setup docontrolador. Exetuca assim que o controlador inicia     * @memberof CerimoniaController     */    function Activate() {      GetDados();    }    /**     * @function ConsultCEP     * @desc Usa o serviço consultCEP para consultar o cep e preenche o formulario com a resposta     * @memberof CerimoniaController     */    function ConsultCEP() {      consultCEP.consultar(vm.dados.ConfiguracaoConvite.Cep).then(function (resp) {        vm.dados.ConfiguracaoConvite.Endereco = resp.logradouro;        vm.dados.ConfiguracaoConvite.Bairro = resp.bairro;        vm.dados.ConfiguracaoConvite.Cidade = resp.cidade;        vm.dados.ConfiguracaoConvite.Estado = resp.estado;      });    }    /**     * @function GetDados     * @desc Pega os dados salvos no servidor     * @memberof CerimoniaController     */    function GetDados() {      vm.carregando = true;      serverService.Get('RetornarConfiguracaoConvite', ID).then(function (resp) {        resp = angular.fromJson(conversorService.Xml2Json(resp.data, ''));        /**         * Se for o primeiro acesso ou se não houver dados salvos nao sera possivel usar o          * split.Se esse eh o caso não ha nada para pegar do servidor.         */        try {          var horario = resp.ConfiguracaoConvite.Horario_cerimonia.split(":");          resp.ConfiguracaoConvite.Tracar_rota_local = 'true'; //força o traçar rota para true          vm.dados = resp;          vm.hora = horario[0];          vm.min = horario[1];        } catch (error) {}        //Salva no session para ser usado na configuração do convite        session.user.cerimonia = vm.dados;        session.SaveState();        vm.carregando = false;      }).catch(function (error) {        /**         * Esse bloco eh executado caso haja algum erro no envio de dados para o servidor         */        console.error('RetornarConfiguracaoConvite -> ', error);        vm.carregando = false;        vm.erro = true;        toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');      });    }    /**     * @function SetDados     * @desc Salva os dados do formulario no servidor     * @memberof CerimoniaController     */    function SetDados() {      vm.carregando = true;      //Junta a hora e os min no formato HH:MM      vm.dados.ConfiguracaoConvite.Horario_cerimonia = vm.hora + ':' + vm.min;      var dados = conversorService.Json2Xml(vm.dados, '');      //Salva as alterações no session para ser usado na configuração de convite      session.user.cerimonia = vm.dados;      session.SaveState();      serverService.Request('ConfiguracaoConvite', dados).then(function (resp) {        vm.carregando = false;        toastr.success('Alterações Salvas!');      }).catch(function (error) {        /**         * Esse bloco eh executado caso haja algum erro no envio de dados para o servidor         */        console.error('RetornarConfiguracaoConvite -> ', error);        vm.carregando = false;        vm.erro = true;        toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');      });    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .controller('SaveDateController', SaveDateController);  SaveDateController.$inject = ['serverService', 'conversorService', 'ListManagerService', 'session', 'toastr', '$rootScope'];  /**   * @memberof dashboard   * @ngdoc controller   * @scope {}   * @name SaveDateController   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Receber e enviar dados do casal ( nome do casal, data de casamento e foto ).&lt;br>   * Pasta de origem : app/convite/date &lt;br>   * State : savethedate &lt;br>   * Controller As : save&lt;br>   * Template Url : app/convite/date/save-date.html &lt;br>&lt;br>   * Usa o serviço(s) do(s) servidor:   *  - FormatacaoSaveTheDate {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/FormatacaoSaveTheDate}   *  - RetornarFormatacaoSaveTheDate {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/RetornarFormatacaoSaveTheDate}   *  - EnvioEmailSaveTheDate {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/EnvioEmailSaveTheDate}   *  - RetornarConvidados {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/RetornarConvidados}   * @param {service} serverService      - usado para comunicar com o servidor (server.service.js)   * @param {service} conversorService   - usado para converter xml &lt;-> json (conversor.service.js)   * @param {service} ListManagerService - gerencia listas. Passa um object de uma lista para outra (list.service.js)   * @param {service} session            - usado para armazenar e buscar dados no session (session.service.js)   * @param {service} toastr             - usado para mostrar mensagens ao usuario   * @param {service} $rootScope         - scope geral   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/controller} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#controllers} Para melhores praticas   * @see Veja [Servidor Help]  {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help} Para saber sobre os serviços do servidor   */  function SaveDateController(serverService, conversorService, ListManagerService, session, toastr, $rootScope) {    const enable = $rootScope.pagante; //O usuario so pode enviar o save the date se for pagante    const ID = session.user.id; //id do usuario logado.Usado para fazer requisições    var vm = this;    vm.carregando = true; //Loading das configurações do save the date    vm.carregandoLista = true; // Loading da lista de convidados para envio    vm.convidados = []; //Lista de convidados    //Dados para envio da configuração do save the date    vm.dados = {      'DadosFormatacaoSaveTheDate': {        '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',        '@xmlns:i': 'http://www.w3.org/2001/XMLSchema-instance',        'ErrorMessage': '',        'Result': 'true',        'id_casal': ID,        'id_modelo': '1',        'msg': 'Pessoas especiais como você fazem parte deste momento! O dia ' + session.user.casal.dataCasamento + ' é muito importante para nós, o dia do nosso casamento, e gostaríamos de compartilhá-lo com você. Marque esta data no seu calendário para não se esquecer.  A sua presença é essencial! Em breve você receberá por email, o convite e mais informações do nosso casamento.',        'nomecasal': session.user.casal.nomeNoiva + ' e ' + session.user.casal.nomeNoivo      }    };    vm.erro = false; // Mostra msg de erro caso haja erro no envio de informações ao serviço de configuração    vm.erroLista = false; // Mostra msg de erro caso haja erro no envio de informações ao serviço de convidados    vm.ListManager = ListManagerService; // Atribiu o serviço ao escopo    //Modelos do save the date    vm.modelos = [{        'id': '1',        'image': 'modelo1.png'      },      {        'id': '3',        'image': 'modelo3.png'      },      {        'id': '8',        'image': 'modelo8.png'      }    ];    vm.selecionados = []; //Lista de convidados selecionados para envio    Activate();    /**     * Atribuição das funçoes as variaveis do escopo     */    vm.Enviar = Enviar;    vm.Cancelar = GetDados;    vm.IsThisSelected = IsThisSelected;    vm.SelectImage = SelectImage;    vm.SetDados = SetDados;    ////////////////    /**     * @function Activate     * @desc Setup docontrolador. Exetuca assim que o controlador inicia     * @memberof SaveDateController     */    function Activate() {      GetDados();      GetConvidados();    }    /**     * @function Enviar     * @desc Envia o save the date para a lista de convidados selecionados     * @memberof SaveDateController     */    function Enviar() {      vm.carregandoLista = true;      if (enable) {        var lista = {          'ListaEmailConvidados': {            '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',            'Id_casal': ID,            'Id_convidado': {              'int': []            }          }        };        var xml = null;        angular.forEach(vm.selecionados, function (selecionado) {          lista.ListaEmailConvidados.Id_convidado.int.push({            '@xmlns': 'http://schemas.microsoft.com/2003/10/Serialization/Arrays',            '#text': selecionado.Id          });        });        xml = conversorService.Json2Xml(lista, '');        serverService.Request('EnvioEmailSaveTheDate', xml).then(function (resp) {          toastr.success('Save the Date Enviado!');          GetConvidados();        });      } else {        toastr.error('Você deve efetuar o pagamento para usar essa funcionalidade');        vm.carregandoLista = false;      }    }    /**     * @function GetConvidados     * @desc Pega a lista de convidados do servidor     * @memberof SaveDateController     */    function GetConvidados() {      vm.convidados = [];      vm.selecionados = [];      serverService.Get('RetornarConvidados', ID).then(function (resp) {        resp = angular.fromJson(conversorService.Xml2Json(resp.data, ''));        if (resp.ArrayOfConvidado.Convidado) {          if (resp.ArrayOfConvidado.Convidado.length > 1) {            vm.convidados = resp.ArrayOfConvidado.Convidado;          } else {            vm.convidados.push(resp.ArrayOfConvidado.Convidado);          }        }        delete vm.convidados['@xmlns'];        delete vm.convidados['@xmlns:i'];        vm.carregandoLista = false;      }).catch(function (error) {        console.error('RetornarConvidados -> ', error);        vm.carregandoLista = false;        vm.erroLista = true;        toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');      });    }    /**     * @function GetDados     * @desc Pega a configuração do save the date salva no servidor     * @memberof SaveDateController     */    function GetDados() {      vm.carregando = true;      serverService.Get('RetornarFormatacaoSaveTheDate', ID).then(function (resp) {        /**         * O servico conversorService retorna uma string         * O angular converte de string para objeto         */        resp = angular.fromJson(conversorService.Xml2Json(resp.data, ''));        if (resp.DadosFormatacaoSaveTheDate.id_modelo != '0') {          vm.dados.DadosFormatacaoSaveTheDate.id_modelo = resp.DadosFormatacaoSaveTheDate.id_modelo;          vm.dados.DadosFormatacaoSaveTheDate.msg = resp.DadosFormatacaoSaveTheDate.msg;          SelectImage(vm.dados.DadosFormatacaoSaveTheDate.id_modelo); //marca no layout o modelo selecionado        }        vm.carregando = false;      }).catch(function (error) {        console.error('RetornarFormatacaoSaveTheDate -> ', error);        vm.carregando = false;        vm.erro = true;        toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');      });    }    /**     * @function IsThisSelected     * @desc Verifica se o modelo ja foi selecionado para atribuir uma classe a ele     * Eh usado para marcar o checkbox     * @param {string} id - id do modelo     * @return {boolean}     * @memberof SaveDateController     */    function IsThisSelected(id) {      return (vm.dados.DadosFormatacaoSaveTheDate.id_modelo == id);    }    /**     * @function SelectImage     * @desc Seleciona o modelo do save the date     * @param {string} id - id do modelo     * @memberof SaveDateController     */    function SelectImage(id) {      vm.dados.DadosFormatacaoSaveTheDate.id_modelo = id;    }    /**     * @function SetDados     * @desc Salva a configuração do save the date     * @memberof SaveDateController     */    function SetDados() {      vm.dados.DadosFormatacaoSaveTheDate.Result = 'true'; //precisa disso para nao dar erro      //Eh preciso enviar o nome do casal      vm.dados.DadosFormatacaoSaveTheDate.nomecasal = session.user.casal.nomeNoiva + ' e ' + session.user.casal.nomeNoivo;      var dados = conversorService.Json2Xml(vm.dados, '');      serverService.Request('FormatacaoSaveTheDate', dados).then(function (resp) {        toastr.success('Alterações Salvas!');      });    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .filter('alinhamento', Alinhamento);  /**   * @memberof dashboard   * @ngdoc filter   * @name Alinhamento   * @desc retorna o alinhamento (right,left,center) baseado no numero(0,1,2) &lt;br>   * Pasta de origem : app/convite/filter   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/api/ng/filter/filter} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#filters} Para melhores praticas   */  function Alinhamento() {    return AlinhamentoFilter;    ////////////////    /**     * @function AlinhamentoFilter     * @memberof Alinhamento     * @desc retorna o alinhamento (right,left,center) baseado no numero(0,1,2)     * @param {string} value     * @return {string}     */    function AlinhamentoFilter(value) {      var retorno = '';      switch (value) {        case '2':          retorno = 'right';          break;        case '0':          retorno = 'left';          break;        case '1':          retorno = 'center';          break;        default:          retorno = 'left';          break;      }      return retorno;    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .filter('raplaceHash', RaplaceHash);  /**   * @memberof dashboard   * @ngdoc filter   * @name RaplaceHash   * @desc troca o '#' pela quebra de linha em html &lt;br>   * O servidor so armazena # como quebra de linha &lt;br>   * Pasta de origem : app/convite/filter   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/api/ng/filter/filter} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#filters} Para melhores praticas   */  function RaplaceHash() {    return RaplaceHashFilter;    ////////////////    /**     * @function RaplaceHashFilter     * @memberof RaplaceHash     * @desc troca o '#' pela quebra de linha em html     * @param {string} value     * @return {string}     */    function RaplaceHashFilter(value) {      return (!value) ? '' : value.toString().replace(/#/g, '&lt;br>');    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .filter('removePx', RemovePx);  /**   * @memberof dashboard   * @ngdoc filter   * @name RemovePx   * @desc remove o px dos valores css inline &lt;br>   * O servidor nao armazena o px dos css &lt;br>   * Pasta de origem : app/convite/filter   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/api/ng/filter/filter} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#filters} Para melhores praticas   */  function RemovePx() {    return RemovePxFilter;    ////////////////    /**     * @function RemovePxFilter     * @memberof RemovePx     * @desc remove o px dos valores css inline     * @param {string} value     * @return {string}     */    function RemovePxFilter(value) {      return (!value) ? '' : value.toString().replace(/px/g, '');    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .filter('sufixPx', SufixPx);  /**   * @memberof dashboard   * @ngdoc filter   * @name SufixPx   * @desc adiciona o px dos valores css inline &lt;br>   * O servidor nao armazena o px dos css &lt;br>   * Pasta de origem : app/convite/filter   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/api/ng/filter/filter} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#filters} Para melhores praticas   */  function SufixPx() {    return SufixPxFilter;    ////////////////    /**     * @function SufixPxFilter     * @memberof SufixPx     * @desc adiciona o px dos valores css inline     * @param {string} value     * @return {string}     */    function SufixPxFilter(value) {      return (!value) ? '' : value.toString() + 'px';    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .service('Controlador', Controlador);  Controlador.inject = [];  /**   * @memberof dashboard   * @ngdoc service   * @name Controlador   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Controla qual bloco de style do convite foi selecionado pelo o usuario   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/services} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#services} Para melhores praticas   */  function Controlador() {    this.styleSelected = [];    this.SelectStyle = SelectStyle;    this.HasSelected = HasSelected;    ////////////////    /**     * @function HasSelected     * @desc Verifica se o style atual eh o mesmo que o selecionado. Usado para trocar a classe do bloco     * para marcar qual esta selecionado no momento     * @param {json} style - estilo do bloco     * @return {boolean}     * @memberof Controlador     */    function HasSelected(style) {      return (this.styleSelected === style);    }    /**     * @function SelectStyle     * @desc Seleciona o estilo do bloco.     * @param {json} style - estilo do bloco     * @memberof Controlador     */    function SelectStyle(style) {      this.styleSelected = style;    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .controller('PersonalizarController', PersonalizarController);  PersonalizarController.$inject = ['serverService', 'conversorService', 'session', '$http', '$filter', '$state', 'Controlador', 'toastr'];  /**   * @memberof dashboard   * @ngdoc controller   * @scope {}   * @name PersonalizarController   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Edita o convite escolhido.&lt;br> &lt;strong>!! Não eh possivel editar ou trocar de modelo apos o envio !!&lt;/strong> Isso prejudicaria o APP&lt;br>   * Pasta de origem : app/convite/personalizar &lt;br>   * State : personalizar &lt;br>   * Controller As : convite &lt;br>   * Template Url : app/convite/personalizar/personalizar.html &lt;br>&lt;br>   * Usa o serviço(s) do(s) servidor:   *  - RetornarConvidadosConfirmados {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/RetornarConvidadosConfirmados}   *  - RetornarFormatacaoConvite {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/RetornarFormatacaoConvite}   *  - FormatacaoConvite {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/FormatacaoConvite}   * @param {service} serverService    - usado para comunicar com o servidor (server.service.js)   * @param {service} conversorService - usado para converter xml &lt;-> json (conversor.service.js)   * @param {service} session          - usado para armazenar e buscar dados no session (session.service.js)   * @param {service} $http            - usado para pegar o convites.json e fonts.json   * @param {service} $filter          - usado para formatações de texto   * @param {service} $state           - usado para pegar parametro(id do modelo) para a configuração de convite   * @param {service} Controlador      - servico para gerenciar a parsonalização do convite (controlador.service.js)   * @param {service} toastr           - usado para mostrar mensagens ao usuario   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/controller} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#controllers} Para melhores praticas   * @see Veja [Servidor Help]  {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help} Para saber sobre os serviços do servidor   */  function PersonalizarController(serverService, conversorService, session, $http, $filter, $state, Controlador, toastr) {    const ID = session.user.id; //id do usuario logado.Usado para fazer requisições    var vm = this;    vm.carregando = true; // Controla o loading    vm.convites = {}; // Configuração basica dos convites    //Formatação para enviar ao servidor da configuração do convite    vm.dados = {      'DadosFormatacaoConvite': {        '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',        '@xmlns:i': 'http://www.w3.org/2001/XMLSchema-instance',        'alinhamento_msg1': '1', // id do alinhamento. Existe funcao para converter        'alinhamento_msg2': '1',        'alinhamento_msg3': '1',        'alinhamento_msg4': '1',        'alinhamento_nomecasal': '1',        'alinhamento_pais_noiva': '1',        'alinhamento_pais_noivo': '1',        'conteudo_msg1': 'convidam para a cerimônia de casamento dos seus filhos', // Conteudo padrao. Nao altera        'conteudo_msg2': '',        'conteudo_msg3': '',        'conteudo_msg4': '',        'conteudo_nomecasal': '',        //Padrao do nome dos pais. Nao eh alterado        'conteudo_pais_noiva': session.user.cerimonia.ConfiguracaoConvite.Pai_noiva + '#' + session.user.cerimonia.ConfiguracaoConvite.Mae_noiva,        'conteudo_pais_noivo': session.user.cerimonia.ConfiguracaoConvite.Pai_noivo + '#' + session.user.cerimonia.ConfiguracaoConvite.Mae_noivo,        //Nao existe opção para alterar a cor. A cor eh padrao        'cor_msg1': '#3333',        'cor_msg2': '#3333',        'cor_msg3': '#3333',        'cor_msg4': '#3333',        'cor_nomecasal': '#3333',        'cor_pais_noiva': '#3333',        'cor_pais_noivo': '#3333',        'fonte_msg1': '1', //Id da fonte. Existe funcao para converter        'fonte_msg2': '1',        'fonte_msg3': '1',        'fonte_msg4': '1',        'fonte_nomecasal': '1',        'fonte_pais_noiva': '1',        'fonte_pais_noivo': '1',        'id_casal': ID,        'id_modelo': '0',        'tamanho_fonte_msg1': '1', //O tamanho da fonte eh sem o px        'tamanho_fonte_msg2': '1',        'tamanho_fonte_msg3': '1',        'tamanho_fonte_msg4': '1',        'tamanho_fonte_pais_noiva': '1',        'tamanho_fonte_pais_noivo': '1',        'tamanho_nomecasal': '1'      }    };    vm.editionEnable = true; //Controla se o usuario pode editar    vm.erro = false; //Mostra erro se houver erro para conectar ao servidor    vm.fonts = []; //Fontes disponiveis para edição    vm.idConvite = 1; //Id do convite    vm.imageSelected = ''; // Imagem de fundo do convite    //Estilos dos blocos do convite    vm.styles = {      'bloco1': {},      'bloco2': {},      'bloco3': {},      'bloco4': {},      'nomeCasal': {},      'paisNoivo': {},      'paisNoiva': {}    };    /**     * Quando o usuario clica em um bloco     * essa variavel armazena o estilo desse bloco     * para poder fazer a edição ( alinhamento, tamanho de fonte, tipo de fonte)     */    vm.styleSelected = [];    /**     * Atribuição das funçoes as variaveis do escopo     */    vm.Controlador = Controlador; //service    vm.Salvar = Salvar;    Activate();    ////////////////    /**     * @function Activate     * @desc Setup docontrolador. Exetuca assim que o controlador inicia     * @memberof PersonalizarController     */    function Activate() {      CheckSend();      GetDados();    }    /**     * @function CheckSend     * @desc Verifica se o casal ja enviou os convites. Nao eh possivel editar ou alterar o modelo do convite se ja foi enviado.     * @memberof PersonalizarController     */    function CheckSend() {      serverService.Get('RetornarConvidadosConfirmados', ID).then(function (resp) {        resp = angular.fromJson(conversorService.Xml2Json(resp.data, ''));        var pessoas = resp.ArrayOfListaConvidadosConfirmados.ListaConvidadosConfirmados;        if (pessoas !== undefined) {          vm.editionEnable = false;        }      });    }    /**     * @function GetAlignId     * @desc Setup docontrolador. Exetuca assim que o controlador inicia     * @param {service} align - nome do alinhamento (left,center,right)     * @return {string} id do alinhamento (0,1,2)     * @memberof PersonalizarController     */    function GetAlignId(align) {      var retorno = '';      switch (align) {        case 'right':          retorno = '2';          break;        case 'left':          retorno = '0';          break;        case 'center':          retorno = '1';          break;        default:          retorno = '0';          break;      }      return retorno;    }    /**     * @function GetDados     * @desc Pega a configuração do covnite do servidor. As fonts e a configuração basica dos convites     * @memberof PersonalizarController     */    function GetDados() {      serverService.Get('RetornarFormatacaoConvite', ID).then(function (resp) {        resp = angular.fromJson(conversorService.Xml2Json(resp.data, ''));        /**         * modelo = 0 significa que não ha configuração salva.         */        if (resp.DadosFormatacaoConvite.id_modelo === '0') {          session.user.convite = vm.dados;        } else {          session.user.convite = vm.dados = resp;        }        session.SaveState();        //pega o id do modelo do convite        if ($state.params.idModelo) {          vm.idConvite = $state.params.idModelo;        } else {          vm.idConvite = resp.DadosFormatacaoConvite.id_modelo;        }        //Pega as configuracoes padrao dos convites        $http({          method: 'GET',          url: 'app/convite/convites.json'        }).then(function (resp) {          vm.convites = resp.data;          //Pega todas as fonts          $http({            method: 'GET',            url: 'app/convite/fonts.json'          }).then(function (data) {            vm.fonts = data.data;            vm.imageSelected = 'image/convites/convite' + vm.idConvite + '.png';            /**             * Se houver id vindo de paramentro significa que o usuario             * escolheu um modelo. Portanto, eh so colocar as configurações basicas no convite             * Se nao houver, significa que o usuario esta editando um convite ja configurado, nesse caso             * aplica as configurações salvas no servidor             */            if ($state.params.idModelo) {              SetDefault(); // Configuração padrao do convites            } else {              SetStyles(); // Configuração salva no servidor            }          });        });      }).catch(function (error) {        /**         * Esse bloco eh executado caso haja algum erro no envio de dados para o servidor         */        console.error('RetornarFormatacaoConvite -> ', error);        vm.carregando = false;        vm.erro = true;        toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');      });    }    /**     * @function GetFont     * @desc Busca o nome da fonte baseado no id fornecido. O servidor armazena apenas o id e nao o nome da fonte     * @param {string} id - id da fonte     * @return {string} Nome da fonte     * @memberof PersonalizarController     */    function GetFont(id) {      try {        var serif = vm.fonts.SERIF[id]['font-name'];        return serif;      } catch (e) {        try {          var sansserif = vm.fonts.SANSSERIF[id]['font-name'];          return sansserif;        } catch (e) {          try {            var display = vm.fonts.DISPLAY[id]['font-name'];            return display;          } catch (e) {            try {              var handwriting = vm.fonts.HANDWRITING[id]['font-name'];              return handwriting;            } catch (e) {              return null;            }          }        }      }    }    /**     * @function GetFontID     * @desc Busca o id baseado no nome da fonte fornecido. O servidor armazena apenas o id e nao o nome da fonte     * @param {string} fontName - Nome da fonte     * @return {string} Id da fonte     * @memberof PersonalizarController     */    function GetFontID(fontName) {      var retorno = 0;      angular.forEach(vm.fonts, function (value, key) {        angular.forEach(vm.fonts[key], function (value, key) {          var font = value['font-name'];          if (font == fontName) {            retorno = key;          }        });      });      return retorno;    }    /**     * @function Salvar     * @desc Salva a configuração do convite no servidor     * @memberof PersonalizarController     */    function Salvar() {      vm.carregando = true; //Ativa o loading      /**       * O servidor so armazena o id do alinhamento       * Por isso eh preciso converter o alinhamento de cada bloco em id       * A funçao GetAlignId faz isso       */      vm.dados.DadosFormatacaoConvite.alinhamento_msg1 = GetAlignId(vm.styles.bloco1['text-align']);      vm.dados.DadosFormatacaoConvite.alinhamento_msg2 = GetAlignId(vm.styles.bloco2['text-align']);      vm.dados.DadosFormatacaoConvite.alinhamento_msg3 = GetAlignId(vm.styles.bloco3['text-align']);      vm.dados.DadosFormatacaoConvite.alinhamento_msg4 = GetAlignId(vm.styles.bloco4['text-align']);      vm.dados.DadosFormatacaoConvite.alinhamento_nomecasal = GetAlignId(vm.styles.nomeCasal['text-align']);      vm.dados.DadosFormatacaoConvite.alinhamento_pais_noivo = GetAlignId(vm.styles.paisNoivo['text-align']);      vm.dados.DadosFormatacaoConvite.alinhamento_pais_noiva = GetAlignId(vm.styles.paisNoiva['text-align']);      /**       * O servidor armazena o tamanho das fontes sem o px       * Por isso eh preciso retirar o px dos tamanhos de fontes dos blocos       * o filtro removePx faz isso       */      vm.dados.DadosFormatacaoConvite.tamanho_fonte_msg1 = $filter('removePx')(vm.styles.bloco1['font-size']);      vm.dados.DadosFormatacaoConvite.tamanho_fonte_msg2 = $filter('removePx')(vm.styles.bloco2['font-size']);      vm.dados.DadosFormatacaoConvite.tamanho_fonte_msg3 = $filter('removePx')(vm.styles.bloco3['font-size']);      vm.dados.DadosFormatacaoConvite.tamanho_fonte_msg4 = $filter('removePx')(vm.styles.bloco4['font-size']);      vm.dados.DadosFormatacaoConvite.tamanho_nomecasal = $filter('removePx')(vm.styles.nomeCasal['font-size']);      vm.dados.DadosFormatacaoConvite.tamanho_fonte_pais_noivo = $filter('removePx')(vm.styles.paisNoivo['font-size']);      vm.dados.DadosFormatacaoConvite.tamanho_fonte_pais_noiva = $filter('removePx')(vm.styles.paisNoiva['font-size']);      /**       * O servidor so armazena o id da fonte       * Por isso eh converter o nome da fonte em id       * A função GetFontID faz isso       */      vm.dados.DadosFormatacaoConvite.fonte_msg1 = GetFontID(vm.styles.bloco1['font-family']);      vm.dados.DadosFormatacaoConvite.fonte_msg2 = GetFontID(vm.styles.bloco2['font-family']);      vm.dados.DadosFormatacaoConvite.fonte_msg3 = GetFontID(vm.styles.bloco3['font-family']);      vm.dados.DadosFormatacaoConvite.fonte_msg4 = GetFontID(vm.styles.bloco4['font-family']);      vm.dados.DadosFormatacaoConvite.fonte_nomecasal = GetFontID(vm.styles.nomeCasal['font-family']);      vm.dados.DadosFormatacaoConvite.fonte_pais_noivo = GetFontID(vm.styles.paisNoivo['font-family']);      vm.dados.DadosFormatacaoConvite.fonte_pais_noiva = GetFontID(vm.styles.paisNoiva['font-family']);      var dados = conversorService.Json2Xml(vm.dados, '');      serverService.Request('FormatacaoConvite', dados).then(function (resp) {        resp = angular.fromJson(conversorService.Xml2Json(resp.data, ''));        //Verifica se foi realmente salvo        if (resp.ResultadoFormatacaoConvite.Result === 'true') {          toastr.success('Alterações Salvas!');        } else {          toastr.error('Não foi possível salvar as alterações.', 'Erro');        }        vm.carregando = false;      }).catch(function (error) {        /**         * Esse bloco eh executado caso haja algum erro no envio de dados para o servidor         */        console.error('FormatacaoConvite -> ', error);        vm.carregando = false;        vm.erro = true;        toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');      });    }    /**     * @function SetDefault     * @desc Configura o basico do convite     * @memberof PersonalizarController     */    function SetDefault() {      vm.dados.DadosFormatacaoConvite.conteudo_pais_noiva = session.user.cerimonia.ConfiguracaoConvite.Pai_noiva + '#' + session.user.cerimonia.ConfiguracaoConvite.Mae_noiva;      vm.dados.DadosFormatacaoConvite.conteudo_pais_noivo = session.user.cerimonia.ConfiguracaoConvite.Pai_noivo + '#' + session.user.cerimonia.ConfiguracaoConvite.Mae_noivo;      vm.dados.DadosFormatacaoConvite.conteudo_msg1 = 'convidam para a cerimônia de casamento dos seus filhos';      vm.dados.DadosFormatacaoConvite.conteudo_msg2 = 'a realizar-se às ' + session.user.cerimonia.ConfiguracaoConvite.Horario_cerimonia + ' horas, dia ' + session.user.casal.dataCasamento + ', ' + session.user.cerimonia.ConfiguracaoConvite.Local_cerimonia;      vm.dados.DadosFormatacaoConvite.conteudo_msg3 = 'Este é um texto de referência para a mensagem do seu convite. Para editá-lo clique aqui e reescreva. Se você optar por não ter nenhuma mensagem, basta selecionar o texto e deletar.';      vm.dados.DadosFormatacaoConvite.conteudo_msg4 = 'Cerimônia: # ' + session.user.cerimonia.ConfiguracaoConvite.Local_cerimonia + ' # ' + session.user.cerimonia.ConfiguracaoConvite.Endereco + ', ' + session.user.cerimonia.ConfiguracaoConvite.Numero + ' - ' + session.user.cerimonia.ConfiguracaoConvite.Bairro + ' # ' + session.user.cerimonia.ConfiguracaoConvite.Cidade + ' - ' + session.user.cerimonia.ConfiguracaoConvite.Estado;      vm.dados.DadosFormatacaoConvite.conteudo_nomecasal = session.user.casal.nomeNoiva + ' &amp; ' + session.user.casal.nomeNoivo;      vm.dados.DadosFormatacaoConvite.id_modelo = vm.idConvite;      vm.styles = vm.convites['convite' + vm.idConvite];      //Pega o tamanho da fonte e acrescenta o px      vm.styles.bloco1['font-size'] = $filter('sufixPx')(vm.styles.bloco1['font-size']);      vm.styles.bloco2['font-size'] = $filter('sufixPx')(vm.styles.bloco2['font-size']);      vm.styles.bloco3['font-size'] = $filter('sufixPx')(vm.styles.bloco3['font-size']);      vm.styles.bloco4['font-size'] = $filter('sufixPx')(vm.styles.bloco4['font-size']);      vm.styles.nomeCasal['font-size'] = $filter('sufixPx')(vm.styles.nomeCasal['font-size']);      vm.styles.paisNoivo['font-size'] = $filter('sufixPx')(vm.styles.paisNoivo['font-size']);      vm.styles.paisNoiva['font-size'] = $filter('sufixPx')(vm.styles.paisNoiva['font-size']);      vm.carregando = false; //escode o load    }    /**     * @function SetStyles     * @desc Configura o convite com as informações vindas do servidor     * @memberof PersonalizarController     */    function SetStyles() {      //Pega o padrao do convite      vm.styles = vm.convites['convite' + vm.idConvite];      /**       * O servidor armazena as fontes sem o px       * O filtro sufixPx coloca o px nas fontes       */      vm.styles.bloco1['font-size'] = $filter('sufixPx')(vm.dados.DadosFormatacaoConvite.tamanho_fonte_msg1);      vm.styles.bloco2['font-size'] = $filter('sufixPx')(vm.dados.DadosFormatacaoConvite.tamanho_fonte_msg2);      vm.styles.bloco3['font-size'] = $filter('sufixPx')(vm.dados.DadosFormatacaoConvite.tamanho_fonte_msg3);      vm.styles.bloco4['font-size'] = $filter('sufixPx')(vm.dados.DadosFormatacaoConvite.tamanho_fonte_msg4);      vm.styles.nomeCasal['font-size'] = $filter('sufixPx')(vm.dados.DadosFormatacaoConvite.tamanho_nomecasal);      vm.styles.paisNoivo['font-size'] = $filter('sufixPx')(vm.dados.DadosFormatacaoConvite.tamanho_fonte_pais_noivo);      vm.styles.paisNoiva['font-size'] = $filter('sufixPx')(vm.dados.DadosFormatacaoConvite.tamanho_fonte_pais_noiva);      /**       * O servidor armazena o alinhamento em valor inteiro       * O filtro alinhamento converte para string       */      vm.styles.bloco1['text-align'] = $filter('alinhamento')(vm.dados.DadosFormatacaoConvite.alinhamento_msg1);      vm.styles.bloco2['text-align'] = $filter('alinhamento')(vm.dados.DadosFormatacaoConvite.alinhamento_msg2);      vm.styles.bloco3['text-align'] = $filter('alinhamento')(vm.dados.DadosFormatacaoConvite.alinhamento_msg3);      vm.styles.bloco4['text-align'] = $filter('alinhamento')(vm.dados.DadosFormatacaoConvite.alinhamento_msg4);      vm.styles.nomeCasal['text-align'] = $filter('alinhamento')(vm.dados.DadosFormatacaoConvite.alinhamento_nomecasal);      vm.styles.paisNoivo['text-align'] = $filter('alinhamento')(vm.dados.DadosFormatacaoConvite.alinhamento_pais_noivo);      vm.styles.paisNoiva['text-align'] = $filter('alinhamento')(vm.dados.DadosFormatacaoConvite.alinhamento_pais_noiva);      /**       * O servidor armazena o nome da fonte em valor inteiro       * A funcao GetFont converte para string       */      vm.styles.bloco1['font-family'] = GetFont(vm.dados.DadosFormatacaoConvite.fonte_msg1);      vm.styles.bloco2['font-family'] = GetFont(vm.dados.DadosFormatacaoConvite.fonte_msg2);      vm.styles.bloco3['font-family'] = GetFont(vm.dados.DadosFormatacaoConvite.fonte_msg3);      vm.styles.bloco4['font-family'] = GetFont(vm.dados.DadosFormatacaoConvite.fonte_msg4);      vm.styles.nomeCasal['font-family'] = GetFont(vm.dados.DadosFormatacaoConvite.fonte_nomecasal);      vm.styles.paisNoivo['font-family'] = GetFont(vm.dados.DadosFormatacaoConvite.fonte_pais_noivo);      vm.styles.paisNoiva['font-family'] = GetFont(vm.dados.DadosFormatacaoConvite.fonte_pais_noiva);      Controlador.SelectStyle(vm.styles.bloco3); //seleciona o bloco para edicao      vm.carregando = false; //escode o load    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .controller('SideConviteController', SideConviteController);  SideConviteController.$inject = ['Controlador', '$http', '$filter'];  /**   * @memberof dashboard   * @ngdoc controller   * @scope {}   * @name SideConviteController   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Responsavel pelos controles na barra lateral quando edita o convite&lt;br>   * Pasta de origem : app/convite/date &lt;br>   * State :  &lt;br>   * Controller As : side &lt;br>   * Template Url : app/convite/personalizar/sidebar.html &lt;br>&lt;br>   * Usa o serviço(s) do(s) servidor:   * @param {service} Controlador      - servico para gerenciar a parsonalização do convite. O serviço eh usado como 'ponte' entre esse controlador e o personalizar.controller.js (controlador.service.js)   * @param {service} $http            - usado para pegar o fonts.json   * @param {service} $filter          - usado para formatações de texto   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/controller} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#controllers} Para melhores praticas   * @see Veja [Servidor Help]  {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help} Para saber sobre os serviços do servidor   */  function SideConviteController(Controlador, $http, $filter) {    var vm = this;    vm.fonts = []; //Lista de fontes disponiveis para escolha    vm.fontSize = 0; //Informa o tamanho da fonte do bloco selecionado para o usuario    vm.Controlador = Controlador; //Atribuição de service ao escopo    /**     * Atribuição das funçoes as variaveis do escopo     */    vm.AlignSelected = AlignSelected;    vm.ChangeFontSize = ChangeFontSize;    vm.FontSelected = FontSelected;    vm.SetAlign = SetAlign;    vm.SetFont = SetFont;    Activate();    ////////////////    /**     * @function Activate     * @desc Setup docontrolador. Exetuca assim que o controlador inicia     * @memberof SideConviteController     */    function Activate() {      //Pega todas as fonts      $http({        method: 'GET',        url: 'app/convite/fonts.json'      }).then(function (data) {        vm.fonts = data.data;      });    }    /**     * @function AlignSelected     * @desc Usado para alterar a classe do botao de seleção de alinhamento. Serve para mostrar visualmente     * ao usuario qual o alinhamento esta selecionado.     * @param {string} id - id da fonte     * @return {boolean}     * @memberof SideConviteController     */    function AlignSelected(id) {      return (Controlador.styleSelected['text-align'] === $filter('alinhamento')(id));    }    /**     * @function ChangeFontSize     * @desc Altera o tamanho da fonte do bloco selecionado     * @memberof SideConviteController     */    function ChangeFontSize() {      Controlador.styleSelected['font-size'] = $filter('sufixPx')(vm.fontSize);    }    /**     * @function FontSelected     * @desc Usado para alterar a classe o botao da fonte. Para mostrar visualemente qual fonte foi selecionada para aquele bloco     * @param {string} idFont - id da fonte     * @return {boolean}     * @memberof SideConviteController     */    function FontSelected(idFont) {      var font = GetFont(idFont);      return (Controlador.styleSelected['font-family'] === font);    }    /**     * @function GetFont     * @desc Pega o nome da fonte baseado no id fornecido     * @param {string} id - id da fonte     * @return {string} nome da fonte     * @memberof SideConviteController     */    function GetFont(id) {      try {        var serif = vm.fonts.SERIF[id]['font-name'];        return serif;      } catch (e) {        try {          var sansserif = vm.fonts.SANSSERIF[id]['font-name'];          return sansserif;        } catch (e) {          try {            var display = vm.fonts.DISPLAY[id]['font-name'];            return display;          } catch (e) {            try {              var handwriting = vm.fonts.HANDWRITING[id]['font-name'];              return handwriting;            } catch (e) {              return null;            }          }        }      }    }    /**     * @function SetAlign     * @desc Define o alinhamento selecionado pelo usuario ao bloco selecionado     * @param {string} id - id do alinhamento     * @memberof SideConviteController     */    function SetAlign(id) {      Controlador.styleSelected['text-align'] = $filter('alinhamento')(id);    }    /**     * @function SetFont     * @desc Define a fonte selecionada pelo usuario ao bloco selecionado     * @param {string} idFont - id da fonte     * @memberof SideConviteController     */    function SetFont(idFont) {      Controlador.styleSelected['font-family'] = GetFont(idFont);    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .controller('ConviteController', ConviteController);  ConviteController.$inject = ['serverService', 'conversorService', 'session', '$http', '$filter', '$state', '$window', 'toastr'];  /**   * @memberof dashboard   * @ngdoc controller   * @scope {}   * @name ConviteController   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc Mostra o convite, se já tiver feito a configuração, para o usuario. Mostra todos os modelos de convites para o usuario escolher.   * Depois de ecolher ele eh direcionado a configuração.O usuario pode editar o convite depois de convigurado.&lt;br>   * &lt;strong>!! Não eh possivel editar ou trocar de modelo apos o envio !!&lt;/strong> Isso prejudicaria o APP&lt;br>   * Pasta de origem : app/convite/selecao &lt;br>   * State : convite &lt;br>   * Controller As : convite&lt;br>   * Template Url : app/convite/selecao/convite.html &lt;br>&lt;br>   * Usa o serviço(s) do(s) servidor:   *  - RetornarConvidadosConfirmados {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/RetornarConvidadosConfirmados}   *  - RetornarFormatacaoConvite {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/RetornarFormatacaoConvite}   * @param {service} serverService    - usado para comunicar com o servidor (server.service.js)   * @param {service} conversorService - usado para converter xml &lt;-> json (conversor.service.js)   * @param {service} session          - usado para armazenar e buscar dados no session (session.service.js)   * @param {service} $http            - usado para pegar o convites.json e fonts.json   * @param {service} $filter          - usado para formatações   * @param {service} $state           - usado para passar parametro para a configuração de convite   * @param {service} $window          - usado para pegar a altura e a largura da tela.   * @param {service} toastr           - usado para mostrar mensagens ao usuario   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/controller} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#controllers} Para melhores praticas   * @see Veja [Servidor Help]  {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help} Para saber sobre os serviços do servidor   */  function ConviteController(serverService, conversorService, session, $http, $filter, $state, $window, toastr) {    const ID = session.user.id;    var vm = this;    /**     * Altura e largura sao usados para configurar a largura e altura do popup      * para a escolha do convite     */    vm.altura = $window.innerHeight;    vm.largura = $window.innerWidth;    vm.carregando = true; //Controla o loading    vm.convites = {}; // Formatação basica dos convites ( recebe o arquivo convites.json)    //Formatação de dados do servidor. Usado para mostrar o convite configurado    vm.dados = {      'DadosFormatacaoConvite': {        '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',        '@xmlns:i': 'http://www.w3.org/2001/XMLSchema-instance',        'alinhamento_msg1': '1',        'alinhamento_msg2': '1',        'alinhamento_msg3': '1',        'alinhamento_msg4': '1',        'alinhamento_nomecasal': '1',        'alinhamento_pais_noiva': '1',        'alinhamento_pais_noivo': '1',        'conteudo_msg1': 'convidam para a cerimônia de casamento dos seus filhos',        'conteudo_msg2': '',        'conteudo_msg3': '',        'conteudo_msg4': '',        'conteudo_nomecasal': '',        'conteudo_pais_noiva': session.user.cerimonia.Pai_noiva + '#' + session.user.cerimonia.Mae_noiva,        'conteudo_pais_noivo': session.user.cerimonia.Pai_noivo + '#' + session.user.cerimonia.Mae_noivo,        'cor_msg1': '#3333',        'cor_msg2': '#3333',        'cor_msg3': '#3333',        'cor_msg4': '#3333',        'cor_nomecasal': '#3333',        'cor_pais_noiva': '#3333',        'cor_pais_noivo': '#3333',        'fonte_msg1': '1',        'fonte_msg2': '1',        'fonte_msg3': '1',        'fonte_msg4': '1',        'fonte_nomecasal': '1',        'fonte_pais_noiva': '1',        'fonte_pais_noivo': '1',        'id_casal': ID,        'id_modelo': '0',        'tamanho_fonte_msg1': '1',        'tamanho_fonte_msg2': '1',        'tamanho_fonte_msg3': '1',        'tamanho_fonte_msg4': '1',        'tamanho_fonte_pais_noiva': '1',        'tamanho_fonte_pais_noivo': '1',        'tamanho_nomecasal': '1'      }    };    vm.dialogUp = false; //Controla o display do popup de confirmação de escolha    vm.editionEnable = true; // Se o casal ja enviou o convite a edição e desabilitada    vm.erro = false; //Mostra erro se houver erro na comunicação com o servidor    vm.fonts = []; //Lista de fontes disponiveis para mostrar o convite ( recebe o arquivo fonts.json)    vm.hasConfig = false; //Se tiver um convite ja configurado, mostra ele.    vm.idConvite = 0; // Id do convite. 0 significa que nao ha configuração salva    vm.imageSelected = ''; // Imagem do convite selecionado. Usado para confirmar a seleção    //Imagens de modelo de convites para a seleção    vm.thumbs = [{      ID: 1,      url: 'image/convites/thumb/thumb1.png',      nome: 'Laranja'    }, {      ID: 2,      url: 'image/convites/thumb/thumb2.png',      nome: 'Arabescos'    }, {      ID: 3,      url: 'image/convites/thumb/thumb3.png',      nome: 'Ramos'    }, {      ID: 4,      url: 'image/convites/thumb/thumb4.png',      nome: 'Plain'    }, {      ID: 5,      url: 'image/convites/thumb/thumb5.png',      nome: 'Orquidea'    }, {      ID: 6,      url: 'image/convites/thumb/thumb6.png',      nome: 'Gold'    }, {      ID: 7,      url: 'image/convites/thumb/thumb7.png',      nome: 'Floral'    }, {      ID: 9,      url: 'image/convites/thumb/thumb9.png',      nome: 'Árvore'    }];    //Estilos de cada bloco do convite. Usado para mostrar o convite configurado    vm.styles = {      'bloco1': {},      'bloco2': {},      'bloco3': {},      'bloco4': {},      'nomeCasal': {},      'paisNoivo': {},      'paisNoiva': {}    };    /**     * Define a altura e largura do popup da confirmação da seleção do convite     * baseado na altura e largura do dispositivo - 100px para dar um espaço para 'respirar'     */    vm.styleDialog = {      'max-width': (vm.largura - 100) + 'px',      'max-height': (vm.altura - 100) + 'px'    };    /**     * Atribuição das funçoes as variaveis do escopo     */    vm.SelectConvite = SelectConvite;    vm.Sim = Sim;    Activate();    ////////////////    /**     * @function Activate     * @desc Setup docontrolador. Exetuca assim que o controlador inicia     * @memberof ConviteController     */    function Activate() {      CheckSend();      GetDados();    }    /**     * @function CheckSend     * @desc Verifica se o casal ja enviou os convites. Nao eh possivel editar ou alterar o modelo do convite se ja foi enviado.     * @memberof ConviteController     */    function CheckSend() {      serverService.Get('RetornarConvidadosConfirmados', ID).then(function (resp) {        resp = angular.fromJson(conversorService.Xml2Json(resp.data, ''));        var pessoas = resp.ArrayOfListaConvidadosConfirmados.ListaConvidadosConfirmados;        if (pessoas !== undefined) {          vm.editionEnable = false;        }      });    }    /**     * @function GetDados     * @desc Pega, do servidor, a formatacao do convite.     * Se houver uma formatacao entao monta o convite para ser mostrado     * Se nao, mostra as opcoes de convites para escolher     * @memberof ConviteController     */    function GetDados() {      serverService.Get('RetornarFormatacaoConvite', ID).then(function (resp) {        resp = angular.fromJson(conversorService.Xml2Json(resp.data, ''));        //salva os dados localmente        session.user.convite = vm.dados = resp;        session.SaveState();        //pega o id do modelo do convite        vm.idConvite = resp.DadosFormatacaoConvite.id_modelo;        if (vm.idConvite !== '0') {          //Pega as configuracoes padrao dos convites          $http({            method: 'GET',            url: 'app/convite/convites.json'          }).then(function (resp) {            vm.convites = resp.data;            //Pega todas as fonts            $http({              method: 'GET',              url: 'app/convite/fonts.json'            }).then(function (data) {              vm.fonts = data.data;              vm.imageSelected = 'image/convites/convite' + vm.idConvite + '.png';              //Personaliza o padrao com as informações do usuario              SetStyles();            });          });        } else {          vm.carregando = false; //escode o load        }      }).catch(function (error) {        /**         * Esse bloco eh executado caso haja algum erro no envio de dados para o servidor         */        console.error('RetornarFormatacaoConvite -> ', error);        vm.carregando = false;        vm.erro = true;        toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');      });    }    /**     * @function GetFont     * @desc Busca o nome da fonte baseado no id fornecido. O servidor armazena apenas o id e nao o nome da fonte     * @param {string} id - id da fonte     * @return {string} Nome da fonte     * @memberof ConviteController     */    function GetFont(id) {      try {        var serif = vm.fonts.SERIF[id]['font-name'];        return serif;      } catch (e) {        try {          var sansserif = vm.fonts.SANSSERIF[id]['font-name'];          return sansserif;        } catch (e) {          try {            var display = vm.fonts.DISPLAY[id]['font-name'];            return display;          } catch (e) {            try {              var handwriting = vm.fonts.HANDWRITING[id]['font-name'];              return handwriting;            } catch (e) {              return null;            }          }        }      }    }    /**     * @function SelectConvite     * @desc Armazena o id e url do convite selecionado e depois mostra o popup de confirmação.     * A url eh usada para mostrar o modelo novamente na confirmação     * E o id eh armazenado para enviar para a personalização de convite     * @param {string} id - id do modelo do convite     * @param {string} url - caminho do thumb.     * @memberof ConviteController     */    function SelectConvite(id, url) {      vm.imageSelected = url;      vm.idConvite = id;      vm.dialogUp = true;    }    /**     * @function SetStyles     * @desc Configura os estilos (css) de cada bloco do convite     * @memberof ConviteController     */    function SetStyles() {      //Pega o padrao do convite      vm.styles = vm.convites['convite' + vm.idConvite];      /**       * O servidor armazena as fontes sem o px       * O filtro sufixPx coloca o px nas fontes       */      vm.styles.bloco1['font-size'] = $filter('sufixPx')(vm.dados.DadosFormatacaoConvite.tamanho_fonte_msg1);      vm.styles.bloco2['font-size'] = $filter('sufixPx')(vm.dados.DadosFormatacaoConvite.tamanho_fonte_msg2);      vm.styles.bloco3['font-size'] = $filter('sufixPx')(vm.dados.DadosFormatacaoConvite.tamanho_fonte_msg3);      vm.styles.bloco4['font-size'] = $filter('sufixPx')(vm.dados.DadosFormatacaoConvite.tamanho_fonte_msg4);      vm.styles.nomeCasal['font-size'] = $filter('sufixPx')(vm.dados.DadosFormatacaoConvite.tamanho_nomecasal);      vm.styles.paisNoivo['font-size'] = $filter('sufixPx')(vm.dados.DadosFormatacaoConvite.tamanho_fonte_pais_noivo);      vm.styles.paisNoiva['font-size'] = $filter('sufixPx')(vm.dados.DadosFormatacaoConvite.tamanho_fonte_pais_noiva);      /**       * O servidor armazena o alinhamento em valor inteiro       * O filtro alinhamento converte para string (left, center ou right)       */      vm.styles.bloco1['text-align'] = $filter('alinhamento')(vm.dados.DadosFormatacaoConvite.alinhamento_msg1);      vm.styles.bloco2['text-align'] = $filter('alinhamento')(vm.dados.DadosFormatacaoConvite.alinhamento_msg2);      vm.styles.bloco3['text-align'] = $filter('alinhamento')(vm.dados.DadosFormatacaoConvite.alinhamento_msg3);      vm.styles.bloco4['text-align'] = $filter('alinhamento')(vm.dados.DadosFormatacaoConvite.alinhamento_msg4);      vm.styles.nomeCasal['text-align'] = $filter('alinhamento')(vm.dados.DadosFormatacaoConvite.alinhamento_nomecasal);      vm.styles.paisNoivo['text-align'] = $filter('alinhamento')(vm.dados.DadosFormatacaoConvite.alinhamento_pais_noivo);      vm.styles.paisNoiva['text-align'] = $filter('alinhamento')(vm.dados.DadosFormatacaoConvite.alinhamento_pais_noiva);      /**       * O servidor armazena o tipo de fonte em valor inteiro (id)       * Eh preciso pegar o nome da fonte.       */      vm.styles.bloco1['font-family'] = GetFont(vm.dados.DadosFormatacaoConvite.fonte_msg1);      vm.styles.bloco2['font-family'] = GetFont(vm.dados.DadosFormatacaoConvite.fonte_msg2);      vm.styles.bloco3['font-family'] = GetFont(vm.dados.DadosFormatacaoConvite.fonte_msg3);      vm.styles.bloco4['font-family'] = GetFont(vm.dados.DadosFormatacaoConvite.fonte_msg4);      vm.styles.nomeCasal['font-family'] = GetFont(vm.dados.DadosFormatacaoConvite.fonte_nomecasal);      vm.styles.paisNoivo['font-family'] = GetFont(vm.dados.DadosFormatacaoConvite.fonte_pais_noivo);      vm.styles.paisNoiva['font-family'] = GetFont(vm.dados.DadosFormatacaoConvite.fonte_pais_noiva);      vm.carregando = false; //Escode o load      vm.hasConfig = true; //Mostra o convite configurado    }    /**     * @function Sim     * @desc Quando o usuario confirma a seleção ele eh enviado para a personalização do convite     * Eh passado o id do modelo escolhido por parametro     * @memberof ConviteController     */    function Sim() {      $state.go('personalizar', {        idModelo: vm.idConvite      });    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .controller('CardapioController', CardapioController);  CardapioController.$inject = ['serverService', 'conversorService', 'ListManagerService', 'session', 'toastr', '$rootScope'];  /**   * @memberof dashboard   * @ngdoc controller   * @scope {}   * @name CardapioController   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc gerencia o cardapio do casamento. &lt;br>   * Pasta de origem : app/evento/cardapio &lt;br>   * State : cardapio &lt;br>   * Controller As : cardapio &lt;br>   * Template Url : app/evento/cardapio/cardapio.html &lt;br>&lt;br>   * Usa o serviço(s) do(s) servidor:   *  - CadastrarCardapio {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/CadastrarCardapio}   *  - ExcluirCardapio {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/ExcluirCardapio}   *  - RetornarCardapio {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/RetornarCardapio}   * @param {service} serverService       - usado para comunicar com o servidor (server.service.js)   * @param {service} conversorService    - usado para converter xml &lt;-> json (conversor.service.js)   * @param {service} ListManagerService  - gerencia listas. Passa um object de uma lista para outra (list.service.js)   * @param {service} session             - usado para armazenar e buscar dados no session (session.service.js)   * @param {service} toastr              - notificação para o usuario   * @param {service} $rootScope          - scope geral   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/controller} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#controllers} Para melhores praticas   * @see Veja [Servidor Help]  {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help} Para saber sobre os serviços do servidor   */  function CardapioController(serverService, conversorService, ListManagerService, session, toastr, $rootScope) {    const enable = $rootScope.pagante; //somente casal pagante pode adicionar o cardapio    const ID = session.user.id; //id do casal    var vm = this;    vm.dados = {      'Cardapio': {        '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',        'Descricao': '',        'Id': 0,        'Id_usuario_logado': ID,        'Nome': ''      }    };    vm.cardapios = []; //lista do cardapio    vm.carregando = true;    vm.erro = false;    /**     * Atribuição das funçoes as variaveis do escopo     */    vm.Adicionar = Adicionar;    vm.Excluir = Excluir;    Activate();    ////////////////    /**     * @function Activate     * @desc Setup docontrolador. Exetuca assim que o controlador inicia     * @memberof CardapioController     */    function Activate() {      GetDados();    }    /**     * @function Adicionar     * @desc Cadastra um novo cardapio     * @memberof CardapioController     */    function Adicionar() {      vm.carregando = true;      if (enable) {        var dados = conversorService.Json2Xml(vm.dados, '');        serverService.Request('CadastrarCardapio', dados).then(function (resp) {          vm.carregando = false;          vm.dados.Cardapio.Descricao = '';          vm.dados.Cardapio.Nome = '';          toastr.success('Cardápio Adicionado');          GetDados();        }).catch(function (error) {          console.error('CadastrarCardapio -> ', error);          vm.carregando = false;          vm.erro = true;          toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');        });      } else {        toastr.error('Você deve efetuar o pagamento para usar essa funcionalidade');        vm.carregando = false;      }    }    /**     * @function Excluir     * @desc Apaga o cardapio     * @param {string} id - id do cardapio     * @memberof CardapioController     */    function Excluir(id) {      vm.carregando = true;      var item = {        'ListaRegistrosExcluir': {          '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',          'Id_casal': ID,          'Id_registro': {            'int': [{              '#text': id,              '@xmlns': 'http://schemas.microsoft.com/2003/10/Serialization/Arrays'            }]          }        }      };      var dado = conversorService.Json2Xml(item, '');      serverService.Request('ExcluirCardapio', dado).then(function (resp) {        vm.carregando = false;        toastr.success('Cardápio Excluido');        GetDados();      }).catch(function (error) {        console.error('ExcluirCardapio -> ', error);        vm.carregando = false;        vm.erro = true;        toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');      });    }    /**     * @function GetDados     * @desc Recupera a lista do cardapio do servidor     * @memberof CardapioController     */    function GetDados() {      vm.carregando = true;      vm.cardapios = [];      serverService.Get('RetornarCardapio', ID).then(function (resp) {        /**         * O servico conversorService retorna uma string         * O angular converte de string para objeto         */        resp = angular.fromJson(conversorService.Xml2Json(resp.data, ''));        if (resp.ArrayOfCardapio.Cardapio) {          if (resp.ArrayOfCardapio.Cardapio.length > 1) {            vm.cardapios = resp.ArrayOfCardapio.Cardapio;          } else {            vm.cardapios.push(resp.ArrayOfCardapio.Cardapio);          }        }        vm.carregando = false;      }).catch(function (error) {        console.error('RetornarCardapio -> ', error);        vm.carregando = false;        vm.erro = true;        toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');      });    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .controller('CotasController', CotasController);  CotasController.$inject = ['serverService', 'conversorService', 'ListManagerService', 'session', '$rootScope', 'toastr', 'consultCEP', '$http'];  /**   * @memberof dashboard   * @ngdoc controller   * @scope {}   * @name CotasController   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc gerencia as cotas de lua de mel. &lt;br>   * Pasta de origem : app/evento/cotas &lt;br>   * State : cotas &lt;br>   * Controller As : cotas &lt;br>   * Template Url : app/evento/cotas/cotas.html &lt;br>&lt;br>   * Usa o serviço(s) do(s) servidor:   *  - CriacaoContaVendedorMoip {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/CriacaoContaVendedorMoip}   *  - RetornarContaVendedorMoip {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/RetornarContaVendedorMoip}   *  - RetornarTodosProdutosLuaDeMel {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/RetornarTodosProdutosLuaDeMel}   *  - ConfigurarPresentesEscolhidos {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/ConfigurarPresentesEscolhidos}   * @param {service} serverService       - usado para comunicar com o servidor (server.service.js)   * @param {service} conversorService    - usado para converter xml &lt;-> json (conversor.service.js)   * @param {service} ListManagerService  - gerencia listas. Passa um object de uma lista para outra (list.service.js)   * @param {service} session             - usado para armazenar e buscar dados no session (session.service.js)   * @param {service} $rootScope          - scope geral   * @param {service} toastr              - notificação para o usuario   * @param {service} consultCEP          - serviço para consultar cep   * @param {service} $http               - usado para pegar o arquivo estado.json   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/controller} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#controllers} Para melhores praticas   * @see Veja [Servidor Help]  {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help} Para saber sobre os serviços do servidor   */  function CotasController(serverService, conversorService, ListManagerService, session, $rootScope, toastr, consultCEP, $http) {    const enable = $rootScope.pagante;    const ID = session.user.id;    var vm = this;    vm.carregando = true;    vm.cep = '';    vm.contaCriada = false; //escode o formulario de cadastro se ja foi feita uma conta MOIP    vm.dados = {      'ContaMoip': {        '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',        'Cep': '',        'Cidade': '',        'CodigoAreaTelefone': '',        'Cpf': '',        'DataNascimento': '',        'Email': '',        'Endereco': '',        'Estado': '',        'Id': '0',        'Id_usuario_logado': ID,        'Nome': '',        'Numero': '',        'NumeroTelefone': '',        'Sigla_Estado': '',        'UltimoNome': ''      }    };    vm.data = '';    vm.estados = []; //estados disponiveis para o formulario    vm.erro = false;    vm.link = '';    vm.ListManager = ListManagerService; // atribuicao do serviço no escopo    vm.produtos = []; //lista de produtos    vm.produtosAux = []; //Ajuda a gerenciar a escolha de produtos    vm.produtosEscolhidos = []; // lista de produtos escolhidos    vm.telefone = '';    /**     * Atribuição das funçoes as variaveis do escopo     */    vm.Cep = Cep;    vm.CriarConta = CriarConta;    vm.Salvar = SavarProdutos;    Activate();    ////////////////    /**     * @function Activate     * @desc Setup docontrolador. Exetuca assim que o controlador inicia     * @memberof CotasController     */    function Activate() {      CheckConta();      $http.get('app/evento/cotas/estado.json')        .then(function (resp) {          vm.estados = resp.data;        });    }    /**     * @function CriarConta     * @desc Cria a conta MOIP para o casal     * @memberof CotasController     */    function CriarConta() {      vm.carregando = true;      if (enable) {        var tel = vm.telefone.split(')');        var cep = vm.cep.replace(/\./g, '');        var codigoArea = tel[0];        var split = vm.data.split('/');        var nascimento = split[2] + '-' + split[1] + '-' + split[0];        var idEstado = RetornarIndexEstado(vm.dados.ContaMoip.Sigla_Estado);        tel = tel[1];        tel = tel.replace(/\)/g, '');        tel = tel.replace(/\ /g, '');        tel = tel.replace(/\-/g, '');        cep = cep.replace(/\-/g, '');        codigoArea = codigoArea.replace(/\(/g, '');        vm.dados.ContaMoip.NumeroTelefone = tel;        vm.dados.ContaMoip.CodigoAreaTelefone = codigoArea;        vm.dados.ContaMoip.DataNascimento = nascimento;        vm.dados.ContaMoip.Estado = vm.estados[idEstado].Nome;        vm.dados.ContaMoip.Cep = cep;        var dados = conversorService.Json2Xml(vm.dados, '');        serverService.Request('CriacaoContaVendedorMoip', dados).then(function (resp) {          resp = angular.fromJson(conversorService.Xml2Json(resp.data, ''));          if (!resp.ResultadoCriacaoContaVendedorMoip.Result) {            toastr.error('Não foi possível criar a conta.', 'Erro');          } else {            vm.link = resp.ResultadoCriacaoContaVendedorMoip.LinkSetPassword;            toastr.success('Conta Criada');            vm.contaCriada = true;          }          vm.carregando = false;        });      } else {        toastr.error('Você deve efetuar o pagamento para usar essa funcionalidade');        vm.carregando = false;      }    }    /**     * @function Cep     * @desc Verifica o cep e preenche no formulario     * @memberof CotasController     */    function Cep() {      consultCEP.consultar(vm.cep).then(function (resp) {        vm.dados.ContaMoip.Sigla_Estado = resp.estado;        vm.dados.ContaMoip.Cidade = resp.cidade;        vm.dados.ContaMoip.Endereco = resp.logradouro;        vm.bairro = resp.bairro;      });    }    /**     * @function CheckConta     * @desc Verifica se a conta moip ja foi criada     * @memberof CotasController     */    function CheckConta() {      serverService.Get('RetornarContaVendedorMoip', ID).then(function (resp) {        resp = angular.fromJson(conversorService.Xml2Json(resp.data, ''));        if (resp.ContaVendedorMoip.Result === 'true') {          GetProdutos();          GetProdutosEscolhidos();          vm.contaCriada = true;        }        vm.carregando = false;      });    }    /**     * @function GetProdutos     * @desc Pega os produtos disponiveis para o usuario escolher     * @memberof CotasController     */    function GetProdutos() {      serverService.Get('RetornarTodosProdutosLuaDeMel', ID).then(function (resp) {        resp = angular.fromJson(conversorService.Xml2Json(resp.data, ''));        vm.produtos = resp.ArrayOfPresentesLuaDeMel.PresentesLuaDeMel;      });    }    /**     * @function GetProdutosEscolhidos     * @desc Pega os produtos ja escolhidos pelo usuario     * @memberof CotasController     */    function GetProdutosEscolhidos() {      serverService.Get('RetornarPresentesLuaDeMel', ID).then(function (resp) {        resp = angular.fromJson(conversorService.Xml2Json(resp.data, ''));        if (resp.ArrayOfPresentesLuaDeMel.PresentesLuaDeMel.length > 1) {          vm.produtosAux = resp.ArrayOfPresentesLuaDeMel.PresentesLuaDeMel;        } else {          vm.produtosAux.push(resp.ArrayOfPresentesLuaDeMel.PresentesLuaDeMel);        }        angular.forEach(vm.produtosAux, function (item) {          Transfer(item);        });      });    }    /**     * @function RetornarIndexEstado     * @desc Procura o id do estado para a criação da conta moip     * @param {string} sigla - sigla do estado     * @return {number} id do estado     * @memberof CotasController     */    function RetornarIndexEstado(sigla) {      var count = 0;      var retorno = 0;      angular.forEach(vm.estados, function (item) {        if (item.Sigla === sigla) {          retorno = count;        }        count++;      });      return retorno;    }    /**     * @function SavarProdutos     * @desc Salva os produtos escolhidos     * @memberof CotasController     */    function SavarProdutos() {      var enviarProdutos = {        'ListaPresentesEscolhidos': {          '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',          'Id_casal': ID,          'Id_item': {            'int': []          }        }      };      angular.forEach(vm.produtosEscolhidos, function (item) {        enviarProdutos.ListaPresentesEscolhidos.Id_item.int.push({          '@xmlns': 'http://schemas.microsoft.com/2003/10/Serialization/Arrays',          '#text': item.Id        });      });      var dado = conversorService.Json2Xml(enviarProdutos, '');      serverService.Request('ConfigurarPresentesEscolhidos', dado).then(function (resp) {});    }    /**     * @function Transfer     * @desc Verifica quais ja sao os produtos escolhidos para coloca-los na lista de produtos escolhidos     * @param {object} produto     * @memberof CotasController     */    function Transfer(produto) {      angular.forEach(vm.produtos, function (item) {        if (produto.Id === item.Id) {          vm.produtosEscolhidos.push(item);        }      });    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .controller('HotelController', HotelController);  HotelController.$inject = ['serverService', 'conversorService', 'ListManagerService', 'session', 'toastr', '$rootScope'];  /**   * @todo consultar o cep   * @todo exclusao em massa   * @memberof dashboard   * @ngdoc controller   * @scope {}   * @name HotelController   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc gerencia os hoteis de referencia do casamento. &lt;br>   * Pasta de origem : app/evento/hotel &lt;br>   * State : hotel &lt;br>   * Controller As : hotel &lt;br>   * Template Url : app/evento/hotel/hotel.html &lt;br>&lt;br>   * Usa o serviço(s) do(s) servidor:   *  - ConfigAdicionalEvento_ListaHoteis {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/ConfigAdicionalEvento_ListaHoteis}   *  - ExcluirHoteis {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/ExcluirHoteis}   *  - RetornarConfiguracaoListaHoteis {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/RetornarConfiguracaoListaHoteis}   * @param {service} serverService       - usado para comunicar com o servidor (server.service.js)   * @param {service} conversorService    - usado para converter xml &lt;-> json (conversor.service.js)   * @param {service} ListManagerService  - gerencia listas. Passa um object de uma lista para outra (list.service.js)   * @param {service} session             - usado para armazenar e buscar dados no session (session.service.js)   * @param {service} toastr              - notificação para o usuario   * @param {service} $rootScope          - scope geral   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/controller} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#controllers} Para melhores praticas   * @see Veja [Servidor Help]  {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help} Para saber sobre os serviços do servidor   */  function HotelController(serverService, conversorService, ListManagerService, session, toastr, $rootScope) {    const enable = $rootScope.pagante; //somente usuario pagante pode adicionar um hotel    const ID = session.user.id; //id do usuario logado    var vm = this;    vm.dados = {      'ConfiguracaoGenericaEndereco': {        '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',        'Bairro': '',        'Cidade': '',        'CodigoArea': ' ',        'Email': '',        'Endereco': '',        'Estado': '',        'Id': '0',        'Id_usuario_logado': ID,        'Nome': '',        'Numero': '',        'Obs': ' ',        'Pais': ' ',        'Site': '',        'Telefone': '',        'TipoLogradouro': '',        'Tracar_rota_local': 'true'      }    };    vm.carregando = true;    vm.erro = false;    vm.hoteis = []; //lista de hoteis    /**     * Atribuição das funçoes as variaveis do escopo     */    vm.Adicionar = Adicionar;    vm.Excluir = Excluir;    Activate();    ////////////////    /**     * @function Activate     * @desc Setup docontrolador. Exetuca assim que o controlador inicia     * @memberof HotelController     */    function Activate() {      GetDados();    }    /**     * @function Adicionar     * @desc Adiciona um novo hotel. Somente se o usuario pagou     * @memberof HotelController     */    function Adicionar() {      vm.carregando = true;      if (enable) {        var dados = conversorService.Json2Xml(vm.dados, '');        serverService.Request('ConfigAdicionalEvento_ListaHoteis', dados).then(function (resp) {          vm.carregando = false;          toastr.success('Hotel Adicionado!');          GetDados();        }).catch(function (error) {          console.error('ConfigAdicionalEvento_ListaHoteis -> ', error);          vm.carregando = false;          vm.erro = true;          toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');        });      } else {        toastr.error('Você deve efetuar o pagamento para usar essa funcionalidade');        vm.carregando = false;      }    }    /**     * @function Excluir     * @desc Apaga um hotel     * @param {string} id - id do hotel     * @memberof HotelController     */    function Excluir(id) {      vm.carregando = true;      var item = {        'ListaRegistrosExcluir': {          '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',          'Id_casal': ID,          'Id_registro': {            'int': [{              '#text': id,              '@xmlns': 'http://schemas.microsoft.com/2003/10/Serialization/Arrays'            }]          }        }      };      var dado = conversorService.Json2Xml(item, '');      serverService.Request('ExcluirHoteis', dado).then(function (resp) {        vm.carregando = false;        toastr.success('Hotel Excluido');        /**         * Quando adiciona um novo hotel         * eh preciso recuperar a lista novamente para pegar o id do novo hotel         */        GetDados();      }).catch(function (error) {        console.error('ExcluirHoteis -> ', error);        vm.carregando = false;        vm.erro = true;        toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');      });    }    /**     * @function GetDados     * @desc Recupera a lista de hoteis do servidor     * @memberof HotelController     */    function GetDados() {      vm.carregando = true;      vm.dados = {        'ConfiguracaoGenericaEndereco': {          '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',          'Bairro': '',          'Cidade': '',          'CodigoArea': ' ',          'Email': '',          'Endereco': '',          'Estado': '',          'Id': '0',          'Id_usuario_logado': ID,          'Nome': '',          'Numero': '',          'Obs': ' ',          'Pais': ' ',          'Site': '',          'Telefone': '',          'TipoLogradouro': '',          'Tracar_rota_local': 'true'        }      };      serverService.Get('RetornarConfiguracaoListaHoteis', ID).then(function (resp) {        vm.hoteis = [];        /**         * O servico conversorService retorna uma string         * O angular converte de string para objeto         */        resp = angular.fromJson(conversorService.Xml2Json(resp.data, ''));        if (resp.ArrayOfConfiguracaoGenericaEndereco.ConfiguracaoGenericaEndereco) {          if (resp.ArrayOfConfiguracaoGenericaEndereco.ConfiguracaoGenericaEndereco.length > 1) {            vm.hoteis = resp.ArrayOfConfiguracaoGenericaEndereco.ConfiguracaoGenericaEndereco;          } else {            vm.hoteis.push(resp.ArrayOfConfiguracaoGenericaEndereco.ConfiguracaoGenericaEndereco);          }        }        vm.carregando = false;      }).catch(function (error) {        console.error('RetornarConfiguracaoListaHoteis -> ', error);        vm.carregando = false;        vm.erro = true;        toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');      });    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .controller('PresentesController', PresentesController);  PresentesController.$inject = ['serverService', 'conversorService', 'ListManagerService', 'session', 'toastr', '$rootScope'];  /**   * @todo exclusao em massa   * @memberof dashboard   * @ngdoc controller   * @scope {}   * @name PresentesController   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc gerencia links de listas de presentes do casamento. &lt;br>   * Pasta de origem : app/evento/presentes &lt;br>   * State : presentes &lt;br>   * Controller As : presentes &lt;br>   * Template Url : app/evento/presentes/presentes.html &lt;br>&lt;br>   * Usa o serviço(s) do(s) servidor:   *  - ConfigAdicionalEvento_LojaPresentes {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/ConfigAdicionalEvento_LojaPresentes}   *  - ExcluirLojasPresentes {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/ExcluirLojasPresentes}   *  - RetornarConfiguracaoLojaPresentes {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/RetornarConfiguracaoLojaPresentes}   * @param {service} serverService       - usado para comunicar com o servidor (server.service.js)   * @param {service} conversorService    - usado para converter xml &lt;-> json (conversor.service.js)   * @param {service} ListManagerService  - gerencia listas. Passa um object de uma lista para outra (list.service.js)   * @param {service} session             - usado para armazenar e buscar dados no session (session.service.js)   * @param {service} toastr              - notificação para o usuario   * @param {service} $rootScope          - scope geral   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/controller} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#controllers} Para melhores praticas   * @see Veja [Servidor Help]  {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help} Para saber sobre os serviços do servidor   */  function PresentesController(serverService, conversorService, ListManagerService, session, toastr, $rootScope) {    const enable = $rootScope.pagante; //somente usuarios pagantes podem adicionar    const ID = session.user.id; //id do usuario    var vm = this;    vm.dados = {      'ConfiguracaoLojaPresentes': {        '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',        'Id': 0,        'Id_usuario_logado': ID,        'Nome': '',        'Url': ''      }    };    vm.carregando = true;    vm.erro = false;    vm.presentes = []; //lista de urls    /**     * Atribuição das funçoes as variaveis do escopo     */    vm.Adicionar = Adicionar;    vm.Excluir = Excluir;    Activate();    ////////////////    /**     * @function Activate     * @desc Setup docontrolador. Exetuca assim que o controlador inicia     * @memberof PresentesController     */    function Activate() {      GetDados();    }    /**     * @function Adicionar     * @desc Adiciona uma url de loja     * @memberof PresentesController     */    function Adicionar() {      vm.dados = {        'ConfiguracaoLojaPresentes': {          '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',          'Id': 0,          'Id_usuario_logado': ID,          'Nome': '',          'Url': ''        }      };      vm.carregando = true;      if (enable) {        var dados = conversorService.Json2Xml(vm.dados, '');        serverService.Request('ConfigAdicionalEvento_LojaPresentes', dados).then(function (resp) {          GetDados();          vm.carregando = false;          toastr.success('Loja Adicionada');        }).catch(function (error) {          console.error('ConfigAdicionalEvento_LojaPresentes -> ', error);          vm.carregando = false;          vm.erro = true;          toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');        });      } else {        toastr.error('Você deve efetuar o pagamento para usar essa funcionalidade');        vm.carregando = false;      }    }    /**     * @function Excluir     * @desc Apaga uma url de loja     * @param {string} id - id do link     * @memberof PresentesController     */    function Excluir(id) {      vm.carregando = true;      var item = {        'ListaRegistrosExcluir': {          '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',          'Id_casal': ID,          'Id_registro': {            'int': [{              '#text': id,              '@xmlns': 'http://schemas.microsoft.com/2003/10/Serialization/Arrays'            }]          }        }      };      var dado = conversorService.Json2Xml(item, '');      serverService.Request('ExcluirLojasPresentes', dado).then(function (resp) {        vm.carregando = false;        toastr.success('Loja Excluida');        GetDados();      }).catch(function (error) {        console.error('ExcluirLojasPresentes -> ', error);        vm.carregando = false;        vm.erro = true;        toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');      });    }    /**     * @function GetDados     * @desc Recupera todas as urls cadastradas     * @memberof PresentesController     */    function GetDados() {      vm.carregando = true;      vm.presentes = [];      serverService.Get('RetornarConfiguracaoLojaPresentes', ID).then(function (resp) {        vm.carregando = false;        /**         * O servico conversorService retorna uma string         * O angular converte de string para objeto         */        resp = angular.fromJson(conversorService.Xml2Json(resp.data, ''));        if (resp.ArrayOfConfiguracaoLojaPresentes.ConfiguracaoLojaPresentes) {          if (resp.ArrayOfConfiguracaoLojaPresentes.ConfiguracaoLojaPresentes.length > 1) {            vm.presentes = resp.ArrayOfConfiguracaoLojaPresentes.ConfiguracaoLojaPresentes;          } else {            vm.presentes.push(resp.ArrayOfConfiguracaoLojaPresentes.ConfiguracaoLojaPresentes);          }        }      }).catch(function (error) {        console.error('RetornarConfiguracaoLojaPresentes -> ', error);        vm.carregando = false;        vm.erro = true;        toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');      });    }  }})();
/** * Recepção Controller * Usa os seguinte endpoints: *  - RetornarConfiguracaoEvento *  - ConfiguracaoEvento  * @namespace Controllers */(function () {  'use strict';  angular    .module('dashboard')    .controller('RecepcaoController', RecepcaoController);  RecepcaoController.$inject = ['serverService', 'conversorService', 'session', 'toastr', '$rootScope'];  /**   * @todo consultar o cep   * @todo adicionar s/n   * @todo trocar switch por checkbox   * @memberof dashboard   * @ngdoc controller   * @scope {}   * @name RecepcaoController   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc gerencia os dados da recepção. &lt;br>   * Pasta de origem : app/evento/recepcao &lt;br>   * State : recepcao &lt;br>   * Controller As : recepcao &lt;br>   * Template Url : app/evento/recepcao/recepcao.html &lt;br>&lt;br>   * Usa o serviço(s) do(s) servidor:   *  - RetornarConfiguracaoEvento {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/RetornarConfiguracaoEvento}   *  - ConfiguracaoEvento {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/ConfiguracaoEvento}   * @param {service} serverService       - usado para comunicar com o servidor (server.service.js)   * @param {service} conversorService    - usado para converter xml &lt;-> json (conversor.service.js)   * @param {service} session             - usado para armazenar e buscar dados no session (session.service.js)   * @param {service} toastr              - notificação para o usuario   * @param {service} $rootScope          - scope geral   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/controller} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#controllers} Para melhores praticas   * @see Veja [Servidor Help]  {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help} Para saber sobre os serviços do servidor   */  function RecepcaoController(serverService, conversorService, session, toastr, $rootScope) {    const enable = $rootScope.pagante; //somente pagantes podem alterar as informações    const ID = session.user.id; //id do usuario logado    var dadosAux = {      'ConfiguracaoEvento': {        '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',        '@xmlns:i': 'http://www.w3.org/2001/XMLSchema-instance',        'Bairro': null,        'Cep': null,        'Cidade': null,        'Endereco': null,        'Estado': null,        'Horario_festa': null,        'Id_usuario_logado': ID,        'Local_festa': null,        'Mesmo_local_cerimonia': 'false',        'Numero': null,        'Obs': null,        'Pais': null,        'Tracar_rota_local': 'false'      }    };    var vm = this;    vm.carregando = true;    vm.dados = [];    vm.erro = false;    /**     * O casamento pode nao ter recepcao.     * Essa variavel controla se vai ou nao aparecer o formulario para preencher os dados da recepção     */    vm.hasRecepcao = false;    /**     * Atribuição das funçoes as variaveis do escopo     */    vm.Cancelar = GetDados;    vm.SetDados = SetDados;    Activate();    ////////////////    /**     * @function Activate     * @desc Setup docontrolador. Exetuca assim que o controlador inicia     * @memberof RecepcaoController     */    function Activate() {      vm.dados = dadosAux.ConfiguracaoEvento;      GetDados();    }    /**     * @function GetDados     * @desc Recupera os dados do servidor     * @memberof RecepcaoController     */    function GetDados() {      vm.carregando = true;      serverService.Get('RetornarConfiguracaoEvento', ID).then(function (resp) {        /**         * O servico conversorService retorna uma string         * O angular converte de string para objeto         */        resp = angular.fromJson(conversorService.Xml2Json(resp.data, ''));        /**         * Se for o primeiro acesso, o servidor vai retornar um objeto         */        if (typeof (resp.ConfiguracaoEvento.Bairro) !== 'object') {          vm.dados = dadosAux.ConfiguracaoEvento = resp.ConfiguracaoEvento;          if (vm.dados.Bairro) {            vm.hasRecepcao = true;          }        }        vm.carregando = false;      }).catch(function (error) {        console.error('RetornarConfiguracaoEvento -> ', error);        vm.carregando = false;        vm.erro = true;        toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');      });    }    /**     * @function SetDados     * @desc Salva os dados no servidor     * @memberof RecepcaoController     */    function SetDados() {      vm.carregando = true;      if (enable) {        var dados = conversorService.Json2Xml(dadosAux, '');        serverService.Request('ConfiguracaoEvento', dados).then(function (resp) {          vm.carregando = false;          toastr.success('Alterações Salvas!');        }).catch(function (error) {          console.error('ConfiguracaoEvento -> ', error);          vm.carregando = false;          vm.erro = true;          toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');        });      } else {        toastr.error('Você deve efetuar o pagamento para usar essa funcionalidade');        vm.carregando = false;      }    }  }})();
(function () {  'use strict';  angular    .module('dashboard')    .controller('SalaoController', SalaoController);  SalaoController.$inject = ['serverService', 'conversorService', 'ListManagerService', 'session', '$rootScope', 'toastr'];  /**   * @todo consultar o cep   * @todo exclusao em massa   * @memberof dashboard   * @ngdoc controller   * @scope {}   * @name SalaoController   * @author Leo Brescia &lt;leonardo@leobrescia.com.br>   * @desc gerencia os saloes de beleza. &lt;br>   * Pasta de origem : app/evento/salao &lt;br>   * State : salao &lt;br>   * Controller As : salao &lt;br>   * Template Url : app/evento/salao/salao.html &lt;br>&lt;br>   * Usa o serviço(s) do(s) servidor:   *  - ConfigAdicionalEvento_ListaSaloes {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/ConfigAdicionalEvento_ListaSaloes}   *  - ExcluirSaloes {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/ExcluirSaloes}   *  - RetornarConfiguracaoListaSaloes {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help/operations/RetornarConfiguracaoListaSaloes}   * @param {service} serverService       - usado para comunicar com o servidor (server.service.js)   * @param {service} conversorService    - usado para converter xml &lt;-> json (conversor.service.js)   * @param {service} ListManagerService  - gerencia listas. Passa um object de uma lista para outra (list.service.js)   * @param {service} session             - usado para armazenar e buscar dados no session (session.service.js)   * @param {service} $rootScope          - scope geral   * @param {service} toastr              - notificação para o usuario   * @see Veja [Angular DOC]    {@link https://docs.angularjs.org/guide/controller} Para mais informações   * @see Veja [John Papa DOC]  {@link https://github.com/johnpapa/angular-styleguide/tree/master/a1#controllers} Para melhores praticas   * @see Veja [Servidor Help]  {@link http://52.91.166.105/celebri/ServiceCasamento.svc/help} Para saber sobre os serviços do servidor   */  function SalaoController(serverService, conversorService, ListManagerService, session, $rootScope, toastr) {    const enable = $rootScope.pagante;//somente usuarios pagantes podem adicionar um salao    const ID = session.user.id;//id do usuario    var vm = this;    vm.dados = {      'ConfiguracaoGenericaEndereco': {        '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',        'Bairro': '',        'Cidade': '',        'CodigoArea': ' ',        'Email': '',        'Endereco': '',        'Estado': '',        'Id': '0',        'Id_usuario_logado': ID,        'Nome': '',        'Numero': '',        'Obs': ' ',        'Pais': ' ',        'Site': '',        'Telefone': '',        'TipoLogradouro': '',        'Tracar_rota_local': 'true'      }    };    vm.carregando = true;    vm.saloes = [];//lista dos saloes cadastrados    /**     * Atribuição das funçoes as variaveis do escopo     */    vm.Adicionar = Adicionar;    vm.Excluir = Excluir;    Activate();    ////////////////    /**     * @function Activate     * @desc Setup docontrolador. Exetuca assim que o controlador inicia     * @memberof SalaoController     */    function Activate() {      GetDados();    }    /**     * @function Adicionar     * @desc Adiciona um salao     * @memberof SalaoController     */    function Adicionar() {      vm.carregando = true;      if (enable) {        var dados = conversorService.Json2Xml(vm.dados, '');        serverService.Request('ConfigAdicionalEvento_ListaSaloes', dados).then(function (resp) {          GetDados();          vm.carregando = false;        }).catch(function (error) {          console.error('ConfigAdicionalEvento_ListaSaloes -> ', error);          vm.carregando = false;          vm.erro = true;          toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');        });      } else {        toastr.error('Você deve efetuar o pagamento para usar essa funcionalidade');        vm.carregando = false;      }    }    /**     * @function Excluir     * @desc Apaga um salao     * @param {string} id - id do salao     * @memberof SalaoController     */    function Excluir(id) {      vm.carregando = true;      var item = {        'ListaRegistrosExcluir': {          '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',          'Id_casal': ID,          'Id_registro': {            'int': [{              '#text': id,              '@xmlns': 'http://schemas.microsoft.com/2003/10/Serialization/Arrays'            }]          }        }      };      var dado = conversorService.Json2Xml(item, '');      serverService.Request('ExcluirSaloes', dado).then(function (resp) {        vm.carregando = false;        toastr.success('Salão de beleza Excluido');        GetDados();      }).catch(function (error) {        console.error('ExcluirSaloes -> ', error);        vm.carregando = false;        vm.erro = true;        toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');      });    }    /**     * @function GetDados     * @desc Recupera os saloes cadastrados do servidor     * @memberof SalaoController     */    function GetDados() {      vm.dados = {        'ConfiguracaoGenericaEndereco': {          '@xmlns': 'http://schemas.datacontract.org/2004/07/WcfServiceCasamento',          'Bairro': '',          'Cidade': '',          'CodigoArea': ' ',          'Email': '',          'Endereco': '',          'Estado': '',          'Id': '0',          'Id_usuario_logado': ID,          'Nome': '',          'Numero': '',          'Obs': ' ',          'Pais': ' ',          'Site': '',          'Telefone': '',          'TipoLogradouro': ' ',          'Tracar_rota_local': 'true'        }      };      vm.carregando = true;      vm.saloes = [];      serverService.Get('RetornarConfiguracaoListaSaloes', ID).then(function (resp) {        /**         * O servico conversorService retorna uma string         * O angular converte de string para objeto         */        resp = angular.fromJson(conversorService.Xml2Json(resp.data, ''));        if (resp.ArrayOfConfiguracaoGenericaEndereco.ConfiguracaoGenericaEndereco) {          if (resp.ArrayOfConfiguracaoGenericaEndereco.ConfiguracaoGenericaEndereco > 1) {            vm.saloes = resp.ArrayOfConfiguracaoGenericaEndereco.ConfiguracaoGenericaEndereco;          } else {            vm.saloes.push(resp.ArrayOfConfiguracaoGenericaEndereco.ConfiguracaoGenericaEndereco);          }        }        vm.carregando = false;      }).catch(function (error) {        console.error('RetornarConfiguracaoListaSaloes -> ', error);        vm.carregando = false;        vm.erro = true;        toastr.error('Ocorreu um erro ao tentar acessar o servidor', 'Erro');      });    }  }})();</code></pre>        </article>        <!-- index.html -->        <!-- class files -->      </div>      <footer style="clear:both">        Documentation generated by        <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a>        using        <a href="https://github.com/allenhwkim/angular-jsdoc">Angular-JSDoc template</a>      </footer>    </div>    <script src="js/prettify.js"></script>    <script src="js/angular.min.js"></script>    <script src="js/site.js"></script>    <!--%= prettyJson %-->    <script>      prettyPrint();      var lineNo = window.location.hash.match(/#line([0-9]+)$/);      lineNo && document.querySelector("ol li:nth-child("+(lineNo[1])+")").scrollIntoView();    </script>  </body></html>